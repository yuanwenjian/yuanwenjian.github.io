<!DOCTYPE html>


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
    <meta name="theme-color" content="#222">
    <meta name="google-site-verification" content="mtcPxgu7dngx94l_3Lo41vqUNQxHgj7vMtg7LSQvKvU"/>


    <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
    <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">


    <meta http-equiv="Cache-Control" content="no-transform"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>


    <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>


    <link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css"/>

    <link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css"/>


    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.png?v=5.1.4">


    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


    <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">


    <meta name="keywords" content="Spring,SpringBoot,"/>


    <meta name="description" content="SpringApplication源码解析">
    <meta name="keywords" content="Spring,SpringBoot">
    <meta property="og:type" content="article">
    <meta property="og:title" content="SpringApplication源码解析">
    <meta property="og:url" content="http://yoursite.com/2018/03/31/SpringBoot启动流程及源码分析/index.html">
    <meta property="og:site_name" content="问问苑大宝">
    <meta property="og:description" content="SpringApplication源码解析">
    <meta property="og:locale" content="zh-Hans">
    <meta property="og:image" content="http://yoursite.com/images/springboot/initializer.png">
    <meta property="og:image" content="http://yoursite.com/images/springboot/SpringBootApplicationListener.png">
    <meta property="og:image" content="http://yoursite.com/images/springboot/webApplicationContext.jpg">
    <meta property="og:updated_time" content="2020-06-16T00:57:19.448Z">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="SpringApplication源码解析">
    <meta name="twitter:description" content="SpringApplication源码解析">
    <meta name="twitter:image" content="http://yoursite.com/images/springboot/initializer.png">


    <script type="text/javascript" id="hexo.configurations">
        var NexT = window.NexT || {};
        var CONFIG = {
            root: '/',
            scheme: 'Muse',
            version: '5.1.4',
            sidebar: {
                "position": "left",
                "display": "post",
                "offset": 12,
                "b2t": false,
                "scrollpercent": false,
                "onmobile": false
            },
            fancybox: true,
            tabs: true,
            motion: {
                "enable": true,
                "async": false,
                "transition": {
                    "post_block": "fadeIn",
                    "post_header": "slideDownIn",
                    "post_body": "slideDownIn",
                    "coll_header": "slideLeftIn",
                    "sidebar": "slideUpIn"
                }
            },
            duoshuo: {
                userId: '0',
                author: '博主'
            },
            algolia: {
                applicationID: '',
                apiKey: '',
                indexName: '',
                hits: {"per_page": 10},
                labels: {
                    "input_placeholder": "Search for Posts",
                    "hits_empty": "We didn't find any results for the search: ${query}",
                    "hits_stats": "${hits} results found in ${time} ms"
                }
            }
        };
    </script>


    <link rel="canonical" href="http://yoursite.com/2018/03/31/SpringBoot启动流程及源码分析/"/>


    <title>SpringApplication源码解析 | 问问苑大宝</title>


</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">


<div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    <a href="https://github.com/yuanwenjian" target="_blank"><img
            style="position: absolute; top: 0; right: 0; border: 0;"
            src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67"
            alt="Fork me on GitHub"
            data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner">
            <div class="site-brand-wrapper">
                <div class="site-meta ">


                    <div class="custom-logo-site-title">
                        <a href="/" class="brand" rel="start">
                            <span class="logo-line-before"><i></i></span>
                            <span class="site-title">问问苑大宝</span>
                            <span class="logo-line-after"><i></i></span>
                        </a>
                    </div>

                    <p class="site-subtitle"></p>

                </div>

                <div class="site-nav-toggle">
                    <button>
                        <span class="btn-bar"></span>
                        <span class="btn-bar"></span>
                        <span class="btn-bar"></span>
                    </button>
                </div>
            </div>

            <nav class="site-nav">


                <ul id="menu" class="menu">


                    <li class="menu-item menu-item-home">
                        <a href="/" rel="section">

                            <i class="menu-item-icon fa fa-fw fa-home"></i> <br/>

                            首页
                        </a>
                    </li>


                    <li class="menu-item menu-item-about">
                        <a href="/about/" rel="section">

                            <i class="menu-item-icon fa fa-fw fa-user"></i> <br/>

                            关于
                        </a>
                    </li>


                    <li class="menu-item menu-item-tags">
                        <a href="/tags/" rel="section">

                            <i class="menu-item-icon fa fa-fw fa-tags"></i> <br/>

                            标签
                        </a>
                    </li>


                    <li class="menu-item menu-item-categories">
                        <a href="/categories/" rel="section">

                            <i class="menu-item-icon fa fa-fw fa-th"></i> <br/>

                            分类
                        </a>
                    </li>


                    <li class="menu-item menu-item-archives">
                        <a href="/archives/" rel="section">

                            <i class="menu-item-icon fa fa-fw fa-archive"></i> <br/>

                            归档
                        </a>
                    </li>


                </ul>


            </nav>


        </div>
    </header>

    <main id="main" class="main">
        <div class="main-inner">
            <div class="content-wrap">
                <div id="content" class="content">


                    <div id="posts" class="posts-expand">


                        <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">


                            <div class="post-block">
                                <link itemprop="mainEntityOfPage"
                                      href="http://yoursite.com/2018/03/31/SpringBoot启动流程及源码分析/">

                                <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="问问苑大宝">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/sanguosha.jpg">
    </span>

                                <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="问问苑大宝">
    </span>


                                <header class="post-header">


                                    <h1 class="post-title" itemprop="name headline">SpringApplication源码解析</h1>


                                    <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-31T13:59:00+08:00">
                2018-03-31
              </time>
            

            

            
          </span>


                                        <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring/SpringBoot/" itemprop="url" rel="index">
                    <span itemprop="name">SpringBoot</span>
                  </a>
                </span>

                
                
              
            </span>


                                        <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/03/31/SpringBoot启动流程及源码分析/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count gitment-comments-count" data-xid="/2018/03/31/SpringBoot启动流程及源码分析/"
                        itemprop="commentsCount"></span>
                </a>
              </span>


                                        <div class="post-description">
                                            SpringApplication源码解析
                                        </div>


                                    </div>
                                </header>


                                <div class="post-body" itemprop="articleBody">


                                    <p>SpringBoot启动流程源码解析，版本号为1.5.7</p>
                                    <h1 id="SpringApplication创建"><a href="#SpringApplication创建" class="headerlink"
                                                                    title="SpringApplication创建"></a>SpringApplication创建
                                    </h1>
                                    <figure class="highlight java">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span
                                                            class="line">2</span><br><span
                                                            class="line">3</span><br><span
                                                            class="line">4</span><br><span
                                                            class="line">5</span><br><span
                                                            class="line">6</span><br><span
                                                            class="line">7</span><br><span
                                                            class="line">8</span><br><span
                                                            class="line">9</span><br><span
                                                            class="line">10</span><br><span
                                                            class="line">11</span><br><span
                                                            class="line">12</span><br><span
                                                            class="line">13</span><br><span
                                                            class="line">14</span><br><span
                                                            class="line">15</span><br><span
                                                            class="line">16</span><br><span
                                                            class="line">17</span><br><span
                                                            class="line">18</span><br><span
                                                            class="line">19</span><br><span
                                                            class="line">20</span><br><span
                                                            class="line">21</span><br><span
                                                            class="line">22</span><br><span
                                                            class="line">23</span><br><span
                                                            class="line">24</span><br><span
                                                            class="line">25</span><br><span
                                                            class="line">26</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">run方法调用</span><br><span class="line"><span
                                                            class="function"><span class="keyword">public</span> <span
                                                            class="keyword">static</span> ConfigurableApplicationContext <span
                                                            class="title">run</span><span class="params">(Object[] sources, String[] args)</span> </span>&#123;</span><br><span
                                                            class="line">        <span
                                                            class="keyword">return</span> (<span
                                                            class="keyword">new</span> SpringApplication(sources)).run(args);</span><br><span
                                                            class="line">&#125;</span><br><span class="line"></span><br><span
                                                            class="line">构造方法</span><br><span class="line"><span
                                                            class="function"><span class="keyword">public</span> <span
                                                            class="title">SpringApplication</span><span class="params">(Object... sources)</span> </span>&#123;</span><br><span
                                                            class="line">        <span class="keyword">this</span>.bannerMode = Mode.CONSOLE;</span><br><span
                                                            class="line">        <span class="keyword">this</span>.logStartupInfo = <span
                                                            class="keyword">true</span>;</span><br><span class="line">        <span
                                                            class="keyword">this</span>.addCommandLineProperties = <span
                                                            class="keyword">true</span>;</span><br><span class="line">        <span
                                                            class="keyword">this</span>.headless = <span
                                                            class="keyword">true</span>;</span><br><span class="line">        <span
                                                            class="keyword">this</span>.registerShutdownHook = <span
                                                            class="keyword">true</span>;</span><br><span class="line">        <span
                                                            class="keyword">this</span>.additionalProfiles = <span
                                                            class="keyword">new</span> HashSet();</span><br><span
                                                            class="line">        <span class="keyword">this</span>.initialize(sources);</span><br><span
                                                            class="line">&#125;</span><br><span
                                                            class="line">实例化对象</span><br><span class="line"> <span
                                                            class="function"><span class="keyword">private</span> <span
                                                            class="keyword">void</span> <span
                                                            class="title">initialize</span><span class="params">(Object[] sources)</span> </span>&#123;</span><br><span
                                                            class="line">        <span class="keyword">if</span> (sources != <span
                                                            class="keyword">null</span> &amp;&amp; sources.length &gt; <span
                                                            class="number">0</span>) &#123;</span><br><span
                                                            class="line">            <span class="keyword">this</span>.sources.addAll(Arrays.asList(sources));</span><br><span
                                                            class="line">        &#125;</span><br><span
                                                            class="line"></span><br><span class="line">        <span
                                                            class="keyword">this</span>.webEnvironment = <span
                                                            class="keyword">this</span>.deduceWebEnvironment();  <span
                                                            class="comment">//判断是否为Web环境 根据是否存在"javax.servlet.Servlet", "org.springframework.web.context.ConfigurableWebApplicationContext"这两个类判断 如果都存在，说明是web环境</span></span><br><span
                                                            class="line">        <span class="keyword">this</span>.setInitializers(<span
                                                            class="keyword">this</span>.getSpringFactoriesInstances(ApplicationContextInitializer.class)); <span
                                                            class="comment">//加载Initializer</span></span><br><span
                                                            class="line">        <span class="keyword">this</span>.setListeners(<span
                                                            class="keyword">this</span>.getSpringFactoriesInstances(ApplicationListener.class)); <span
                                                            class="comment">// 加载Listeners</span></span><br><span
                                                            class="line">        <span class="keyword">this</span>.mainApplicationClass = <span
                                                            class="keyword">this</span>.deduceMainApplicationClass(); <span
                                                            class="comment">//推断main方法所在类</span></span><br><span
                                                            class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h2 id="加载Initializers"><a href="#加载Initializers" class="headerlink"
                                                               title="加载Initializers"></a>加载Initializers</h2>
                                    <figure class="highlight java">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span
                                                            class="line">2</span><br><span
                                                            class="line">3</span><br><span
                                                            class="line">4</span><br><span
                                                            class="line">5</span><br><span
                                                            class="line">6</span><br><span
                                                            class="line">7</span><br><span
                                                            class="line">8</span><br><span
                                                            class="line">9</span><br><span
                                                            class="line">10</span><br><span
                                                            class="line">11</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="keyword">private</span> &lt;T&gt; Collection&lt;? extends T&gt; getSpringFactoriesInstances(Class&lt;T&gt; type) &#123;</span><br><span
                                                            class="line">    <span class="keyword">return</span> <span
                                                            class="keyword">this</span>.getSpringFactoriesInstances(type, <span
                                                            class="keyword">new</span> Class[<span
                                                            class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span
                                                            class="line"></span><br><span class="line"><span
                                                            class="keyword">private</span> &lt;T&gt; Collection&lt;? extends T&gt; getSpringFactoriesInstances(Class&lt;T&gt; type, Class&lt;?&gt;[] parameterTypes, Object... args) &#123;</span><br><span
                                                            class="line">    ClassLoader classLoader = Thread.currentThread().getContextClassLoader();</span><br><span
                                                            class="line">    Set&lt;String&gt; names = <span
                                                            class="keyword">new</span> LinkedHashSet(SpringFactoriesLoader.loadFactoryNames(type, classLoader));  <span
                                                            class="comment">//通过spring.factories返回名字，并通过createSpringFactoriesInstances创建对象</span></span><br><span
                                                            class="line">    List&lt;T&gt; instances = <span
                                                            class="keyword">this</span>.createSpringFactoriesInstances(type, parameterTypes, classLoader, args, names);</span><br><span
                                                            class="line">    AnnotationAwareOrderComparator.sort(instances);</span><br><span
                                                            class="line">    <span class="keyword">return</span> instances;</span><br><span
                                                            class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>以上关键代码为SpringFactoriesLoader.loadFactoryNames(type, classLoader)
                                        源码如下,通过以下代码返回spring.factories中ApplicationContextInitializer配置的value返回需要创建对象的名称<br>
                                    <figure class="highlight java">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span
                                                            class="line">2</span><br><span
                                                            class="line">3</span><br><span
                                                            class="line">4</span><br><span
                                                            class="line">5</span><br><span
                                                            class="line">6</span><br><span
                                                            class="line">7</span><br><span
                                                            class="line">8</span><br><span
                                                            class="line">9</span><br><span
                                                            class="line">10</span><br><span
                                                            class="line">11</span><br><span
                                                            class="line">12</span><br><span
                                                            class="line">13</span><br><span
                                                            class="line">14</span><br><span
                                                            class="line">15</span><br><span
                                                            class="line">16</span><br><span
                                                            class="line">17</span><br><span
                                                            class="line">18</span><br><span
                                                            class="line">19</span><br><span
                                                            class="line">20</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"></span><br><span class="line"><span
                                                            class="function"><span class="keyword">public</span> <span
                                                            class="keyword">static</span> List&lt;String&gt; <span
                                                            class="title">loadFactoryNames</span><span class="params">(Class&lt;?&gt; factoryClass, ClassLoader classLoader)</span> </span>&#123;</span><br><span
                                                            class="line">    String factoryClassName = factoryClass.getName();</span><br><span
                                                            class="line"></span><br><span class="line">    <span
                                                            class="keyword">try</span> &#123;</span><br><span
                                                            class="line">        Enumeration&lt;URL&gt; urls = classLoader != <span
                                                            class="keyword">null</span> ? classLoader.getResources(<span
                                                            class="string">"META-INF/spring.factories"</span>) : ClassLoader.getSystemResources(<span
                                                            class="string">"META-INF/spring.factories"</span>);</span><br><span
                                                            class="line">        ArrayList result = <span
                                                            class="keyword">new</span> ArrayList();</span><br><span
                                                            class="line"></span><br><span class="line">        <span
                                                            class="keyword">while</span>(urls.hasMoreElements()) &#123;</span><br><span
                                                            class="line">            URL url = (URL)urls.nextElement();</span><br><span
                                                            class="line">            Properties properties = PropertiesLoaderUtils.loadProperties(<span
                                                            class="keyword">new</span> UrlResource(url));</span><br><span
                                                            class="line">            String factoryClassNames = properties.getProperty(factoryClassName);</span><br><span
                                                            class="line">            result.addAll(Arrays.asList(StringUtils.commaDelimitedListToStringArray(factoryClassNames)));</span><br><span
                                                            class="line">        &#125;</span><br><span
                                                            class="line"></span><br><span class="line">        <span
                                                            class="keyword">return</span> result;</span><br><span
                                                            class="line">    &#125; <span class="keyword">catch</span> (IOException var8) &#123;</span><br><span
                                                            class="line">        <span
                                                            class="keyword">throw</span> <span
                                                            class="keyword">new</span> IllegalArgumentException(<span
                                                            class="string">"Unable to load ["</span> + factoryClass.getName() + <span
                                                            class="string">"] factories from location ["</span> + <span
                                                            class="string">"META-INF/spring.factories"</span> + <span
                                                            class="string">"]"</span>, var8);</span><br><span
                                                            class="line">    &#125;</span><br><span
                                                            class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    </p>
                                    <p>通过以上代码分析得知通过spring.factories文件加载所有Initializers，spring.factories文件如下所示<br>
                                    <figure class="highlight plain">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span
                                                            class="line">2</span><br><span
                                                            class="line">3</span><br><span
                                                            class="line">4</span><br><span
                                                            class="line">5</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">org.springframework.context.ApplicationContextInitializer=\</span><br><span
                                                            class="line">org.springframework.boot.context.ConfigurationWarningsApplicationContextInitializer,\</span><br><span
                                                            class="line">org.springframework.boot.context.ContextIdApplicationContextInitializer,\</span><br><span
                                                            class="line">org.springframework.boot.context.config.DelegatingApplicationContextInitializer,\</span><br><span
                                                            class="line">org.springframework.boot.context.web.ServerPortInfoApplicationContextInitializer</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    </p>
                                    <p>
                                        通过类全称创建对象，对应上一步会生成ConfigurationWarningsApplicationContextInitializer，ContextIdApplicationContextInitializer，DelegatingApplicationContextInitializer，ServerPortInfoApplicationContextInitializer四个对象<br>
                                    <figure class="highlight java">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span
                                                            class="line">2</span><br><span
                                                            class="line">3</span><br><span
                                                            class="line">4</span><br><span
                                                            class="line">5</span><br><span
                                                            class="line">6</span><br><span
                                                            class="line">7</span><br><span
                                                            class="line">8</span><br><span
                                                            class="line">9</span><br><span
                                                            class="line">10</span><br><span
                                                            class="line">11</span><br><span
                                                            class="line">12</span><br><span
                                                            class="line">13</span><br><span
                                                            class="line">14</span><br><span
                                                            class="line">15</span><br><span
                                                            class="line">16</span><br><span
                                                            class="line">17</span><br><span
                                                            class="line">18</span><br><span
                                                            class="line">19</span><br><span
                                                            class="line">20</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="keyword">private</span> &lt;T&gt; <span
                                                            class="function">List&lt;T&gt; <span class="title">createSpringFactoriesInstances</span><span
                                                            class="params">(Class&lt;T&gt; type, Class&lt;?&gt;[] parameterTypes, ClassLoader classLoader, Object[] args, Set&lt;String&gt; names)</span> </span>&#123;</span><br><span
                                                            class="line">    List&lt;T&gt; instances = <span
                                                            class="keyword">new</span> ArrayList(names.size());</span><br><span
                                                            class="line">    Iterator var7 = names.iterator();</span><br><span
                                                            class="line"></span><br><span class="line">    <span
                                                            class="keyword">while</span>(var7.hasNext()) &#123;</span><br><span
                                                            class="line">        String name = (String)var7.next();</span><br><span
                                                            class="line"></span><br><span class="line">        <span
                                                            class="keyword">try</span> &#123;</span><br><span
                                                            class="line">            Class&lt;?&gt; instanceClass = ClassUtils.forName(name, classLoader);</span><br><span
                                                            class="line">            Assert.isAssignable(type, instanceClass);</span><br><span
                                                            class="line">            Constructor&lt;?&gt; constructor = instanceClass.getDeclaredConstructor(parameterTypes);</span><br><span
                                                            class="line">            T instance = BeanUtils.instantiateClass(constructor, args);</span><br><span
                                                            class="line">            instances.add(instance);</span><br><span
                                                            class="line">        &#125; <span
                                                            class="keyword">catch</span> (Throwable var12) &#123;</span><br><span
                                                            class="line">            <span class="keyword">throw</span> <span
                                                            class="keyword">new</span> IllegalArgumentException(<span
                                                            class="string">"Cannot instantiate "</span> + type + <span
                                                            class="string">" : "</span> + name, var12);</span><br><span
                                                            class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span
                                                            class="line"></span><br><span class="line">    <span
                                                            class="keyword">return</span> instances;</span><br><span
                                                            class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    </p>
                                    <p>各个Initializer作用<br><img src="/images/springboot/initializer.png"
                                                               alt="initializer"></p>
                                    <h2 id="创建listeners"><a href="#创建listeners" class="headerlink"
                                                            title="创建listeners"></a>创建listeners</h2>
                                    <p>listeners与initiazer类似，只不过类型改为ApplicationListener,spring.factories文件中值以下代码所示，返回结果为<br>
                                    <figure class="highlight plain">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span
                                                            class="line">2</span><br><span
                                                            class="line">3</span><br><span
                                                            class="line">4</span><br><span
                                                            class="line">5</span><br><span
                                                            class="line">6</span><br><span
                                                            class="line">7</span><br><span
                                                            class="line">8</span><br><span
                                                            class="line">9</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">org.springframework.context.ApplicationListener=\</span><br><span
                                                            class="line">org.springframework.boot.builder.ParentContextCloserApplicationListener,\</span><br><span
                                                            class="line">org.springframework.boot.context.FileEncodingApplicationListener,\</span><br><span
                                                            class="line">org.springframework.boot.context.config.AnsiOutputApplicationListener,\</span><br><span
                                                            class="line">org.springframework.boot.context.config.ConfigFileApplicationListener,\</span><br><span
                                                            class="line">org.springframework.boot.context.config.DelegatingApplicationListener,\</span><br><span
                                                            class="line">org.springframework.boot.liquibase.LiquibaseServiceLocatorApplicationListener,\</span><br><span
                                                            class="line">org.springframework.boot.logging.ClasspathLoggingApplicationListener,\</span><br><span
                                                            class="line">org.springframework.boot.logging.LoggingApplicationListener</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    </p>
                                    <p>以上Listener作用<br><img src="/images/springboot/SpringBootApplicationListener.png"
                                                            alt="Listener"></p>
                                    <p>
                                        推断main方法所在类，通过获取当前调用栈，找到入口方法main所在的类，并将其复制给SpringApplication对象的成员变量mainApplicationClass。</p>
                                    <figure class="highlight java">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span
                                                            class="line">2</span><br><span
                                                            class="line">3</span><br><span
                                                            class="line">4</span><br><span
                                                            class="line">5</span><br><span
                                                            class="line">6</span><br><span
                                                            class="line">7</span><br><span
                                                            class="line">8</span><br><span
                                                            class="line">9</span><br><span
                                                            class="line">10</span><br><span
                                                            class="line">11</span><br><span
                                                            class="line">12</span><br><span
                                                            class="line">13</span><br><span
                                                            class="line">14</span><br><span
                                                            class="line">15</span><br><span
                                                            class="line">16</span><br><span
                                                            class="line">17</span><br><span
                                                            class="line">18</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="keyword">private</span> Class&lt;?&gt; deduceMainApplicationClass() &#123;</span><br><span
                                                            class="line">    <span
                                                            class="keyword">try</span> &#123;</span><br><span
                                                            class="line">        StackTraceElement[] stackTrace = (<span
                                                            class="keyword">new</span> RuntimeException()).getStackTrace();</span><br><span
                                                            class="line">        StackTraceElement[] var2 = stackTrace;</span><br><span
                                                            class="line">        <span class="keyword">int</span> var3 = stackTrace.length;</span><br><span
                                                            class="line"></span><br><span class="line">        <span
                                                            class="keyword">for</span>(<span class="keyword">int</span> var4 = <span
                                                            class="number">0</span>; var4 &lt; var3; ++var4) &#123;</span><br><span
                                                            class="line">            StackTraceElement stackTraceElement = var2[var4];</span><br><span
                                                            class="line">            <span
                                                            class="keyword">if</span> (<span
                                                            class="string">"main"</span>.equals(stackTraceElement.getMethodName())) &#123;</span><br><span
                                                            class="line">                <span
                                                            class="keyword">return</span> Class.forName(stackTraceElement.getClassName());</span><br><span
                                                            class="line">            &#125;</span><br><span
                                                            class="line">        &#125;</span><br><span class="line">    &#125; <span
                                                            class="keyword">catch</span> (ClassNotFoundException var6) &#123;</span><br><span
                                                            class="line">        ;</span><br><span class="line">    &#125;</span><br><span
                                                            class="line"></span><br><span class="line">    <span
                                                            class="keyword">return</span> <span
                                                            class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h1 id="SpringApplication-run-方法"><a href="#SpringApplication-run-方法"
                                                                         class="headerlink"
                                                                         title="SpringApplication run()方法"></a>SpringApplication
                                        run()方法</h1>
                                    <figure class="highlight java">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span
                                                            class="line">2</span><br><span
                                                            class="line">3</span><br><span
                                                            class="line">4</span><br><span
                                                            class="line">5</span><br><span
                                                            class="line">6</span><br><span
                                                            class="line">7</span><br><span
                                                            class="line">8</span><br><span
                                                            class="line">9</span><br><span
                                                            class="line">10</span><br><span
                                                            class="line">11</span><br><span
                                                            class="line">12</span><br><span
                                                            class="line">13</span><br><span
                                                            class="line">14</span><br><span
                                                            class="line">15</span><br><span
                                                            class="line">16</span><br><span
                                                            class="line">17</span><br><span
                                                            class="line">18</span><br><span
                                                            class="line">19</span><br><span
                                                            class="line">20</span><br><span
                                                            class="line">21</span><br><span
                                                            class="line">22</span><br><span
                                                            class="line">23</span><br><span
                                                            class="line">24</span><br><span
                                                            class="line">25</span><br><span
                                                            class="line">26</span><br><span
                                                            class="line">27</span><br><span
                                                            class="line">28</span><br><span
                                                            class="line">29</span><br><span
                                                            class="line">30</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="function"><span
                                                            class="keyword">public</span> ConfigurableApplicationContext <span
                                                            class="title">run</span><span class="params">(String... args)</span> </span>&#123;</span><br><span
                                                            class="line">    StopWatch stopWatch = <span
                                                            class="keyword">new</span> StopWatch();  <span
                                                            class="comment">//记录时间</span></span><br><span class="line">    stopWatch.start();</span><br><span
                                                            class="line">    ConfigurableApplicationContext context = <span
                                                            class="keyword">null</span>;</span><br><span class="line">    FailureAnalyzers analyzers = <span
                                                            class="keyword">null</span>;</span><br><span class="line">    <span
                                                            class="keyword">this</span>.configureHeadlessProperty();</span><br><span
                                                            class="line">    SpringApplicationRunListeners listeners = <span
                                                            class="keyword">this</span>.getRunListeners(args); <span
                                                            class="comment">//加载Listeners</span></span><br><span
                                                            class="line">    listeners.starting(); <span
                                                            class="comment">//listeners启动 这一步发布ApplicationStartedEvent</span></span><br><span
                                                            class="line"></span><br><span class="line">    <span
                                                            class="keyword">try</span> &#123;</span><br><span
                                                            class="line">        ApplicationArguments applicationArguments = <span
                                                            class="keyword">new</span> DefaultApplicationArguments(args);</span><br><span
                                                            class="line">        ConfigurableEnvironment environment = <span
                                                            class="keyword">this</span>.prepareEnvironment(listeners, applicationArguments);  <span
                                                            class="comment">//context创建前环境配置</span></span><br><span
                                                            class="line">        Banner printedBanner = <span
                                                            class="keyword">this</span>.printBanner(environment); <span
                                                            class="comment">//打印banner</span></span><br><span
                                                            class="line">        context = <span
                                                            class="keyword">this</span>.createApplicationContext(); <span
                                                            class="comment">//创建上下文</span></span><br><span class="line">        <span
                                                            class="keyword">new</span> FailureAnalyzers(context);<span
                                                            class="comment">//异常分析</span></span><br><span class="line">        <span
                                                            class="keyword">this</span>.prepareContext(context, environment, listeners, applicationArguments, printedBanner); <span
                                                            class="comment">//context前置处理</span></span><br><span
                                                            class="line">        <span class="keyword">this</span>.refreshContext(context); <span
                                                            class="comment">//context刷新</span></span><br><span
                                                            class="line">        <span class="keyword">this</span>.afterRefresh(context, applicationArguments); <span
                                                            class="comment">//后置处理</span></span><br><span class="line">        listeners.finished(context, (Throwable)<span
                                                            class="keyword">null</span>); <span class="comment">//listener完成</span></span><br><span
                                                            class="line">        stopWatch.stop();</span><br><span
                                                            class="line">        <span class="keyword">if</span> (<span
                                                            class="keyword">this</span>.logStartupInfo) &#123;</span><br><span
                                                            class="line">            (<span class="keyword">new</span> StartupInfoLogger(<span
                                                            class="keyword">this</span>.mainApplicationClass)).logStarted(<span
                                                            class="keyword">this</span>.getApplicationLog(), stopWatch);</span><br><span
                                                            class="line">        &#125;</span><br><span
                                                            class="line"></span><br><span class="line">        <span
                                                            class="keyword">return</span> context;</span><br><span
                                                            class="line">    &#125; <span class="keyword">catch</span> (Throwable var9) &#123;</span><br><span
                                                            class="line">        <span class="keyword">this</span>.handleRunFailure(context, listeners, (FailureAnalyzers)analyzers, var9);</span><br><span
                                                            class="line">        <span
                                                            class="keyword">throw</span> <span
                                                            class="keyword">new</span> IllegalStateException(var9);</span><br><span
                                                            class="line">    &#125;</span><br><span
                                                            class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h2 id="加载Listeners"><a href="#加载Listeners" class="headerlink"
                                                            title="加载Listeners"></a>加载Listeners</h2>
                                    <figure class="highlight java">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span
                                                            class="line">2</span><br><span
                                                            class="line">3</span><br><span
                                                            class="line">4</span><br><span
                                                            class="line">5</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="function"><span
                                                            class="keyword">private</span> SpringApplicationRunListeners <span
                                                            class="title">getRunListeners</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span
                                                            class="line">    Class&lt;?&gt;[] types = <span
                                                            class="keyword">new</span> Class[]&#123;SpringApplication.class, String[].class&#125;;</span><br><span
                                                            class="line">    <span class="comment">// 传入SpringApplicationRunListener </span></span><br><span
                                                            class="line">    <span class="keyword">return</span> <span
                                                            class="keyword">new</span> SpringApplicationRunListeners(logger, <span
                                                            class="keyword">this</span>.getSpringFactoriesInstances(SpringApplicationRunListener.class, types, <span
                                                            class="keyword">this</span>, args));</span><br><span
                                                            class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>与以上加载initialazer类似，类名改为SpringApplicationRunListener，springfactories配置</p>
                                    <figure class="highlight plain">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span class="line">2</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">org.springframework.boot.SpringApplicationRunListener=\</span><br><span
                                                            class="line">org.springframework.boot.context.event.EventPublishingRunListener</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h3 id="EventPublishingRunListener作用"><a href="#EventPublishingRunListener作用"
                                                                             class="headerlink"
                                                                             title="EventPublishingRunListener作用"></a>EventPublishingRunListener作用
                                    </h3>
                                    <figure class="highlight java">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span
                                                            class="line">2</span><br><span
                                                            class="line">3</span><br><span
                                                            class="line">4</span><br><span
                                                            class="line">5</span><br><span
                                                            class="line">6</span><br><span
                                                            class="line">7</span><br><span
                                                            class="line">8</span><br><span
                                                            class="line">9</span><br><span
                                                            class="line">10</span><br><span
                                                            class="line">11</span><br><span
                                                            class="line">12</span><br><span
                                                            class="line">13</span><br><span
                                                            class="line">14</span><br><span
                                                            class="line">15</span><br><span
                                                            class="line">16</span><br><span
                                                            class="line">17</span><br><span
                                                            class="line">18</span><br><span
                                                            class="line">19</span><br><span
                                                            class="line">20</span><br><span
                                                            class="line">21</span><br><span
                                                            class="line">22</span><br><span
                                                            class="line">23</span><br><span
                                                            class="line">24</span><br><span
                                                            class="line">25</span><br><span
                                                            class="line">26</span><br><span
                                                            class="line">27</span><br><span
                                                            class="line">28</span><br><span
                                                            class="line">29</span><br><span
                                                            class="line">30</span><br><span
                                                            class="line">31</span><br><span
                                                            class="line">32</span><br><span
                                                            class="line">33</span><br><span
                                                            class="line">34</span><br><span
                                                            class="line">35</span><br><span
                                                            class="line">36</span><br><span
                                                            class="line">37</span><br><span
                                                            class="line">38</span><br><span
                                                            class="line">39</span><br><span
                                                            class="line">40</span><br><span
                                                            class="line">41</span><br><span
                                                            class="line">42</span><br><span
                                                            class="line">43</span><br><span
                                                            class="line">44</span><br><span
                                                            class="line">45</span><br><span
                                                            class="line">46</span><br><span
                                                            class="line">47</span><br><span
                                                            class="line">48</span><br><span
                                                            class="line">49</span><br><span
                                                            class="line">50</span><br><span
                                                            class="line">51</span><br><span
                                                            class="line">52</span><br><span
                                                            class="line">53</span><br><span
                                                            class="line">54</span><br><span
                                                            class="line">55</span><br><span
                                                            class="line">56</span><br><span
                                                            class="line">57</span><br><span
                                                            class="line">58</span><br><span
                                                            class="line">59</span><br><span
                                                            class="line">60</span><br><span
                                                            class="line">61</span><br><span
                                                            class="line">62</span><br><span
                                                            class="line">63</span><br><span
                                                            class="line">64</span><br><span
                                                            class="line">65</span><br><span
                                                            class="line">66</span><br><span
                                                            class="line">67</span><br><span
                                                            class="line">68</span><br><span
                                                            class="line">69</span><br><span
                                                            class="line">70</span><br><span
                                                            class="line">71</span><br><span
                                                            class="line">72</span><br><span
                                                            class="line">73</span><br><span
                                                            class="line">74</span><br><span
                                                            class="line">75</span><br><span
                                                            class="line">76</span><br><span
                                                            class="line">77</span><br><span
                                                            class="line">78</span><br><span
                                                            class="line">79</span><br><span
                                                            class="line">80</span><br><span
                                                            class="line">81</span><br><span
                                                            class="line">82</span><br><span
                                                            class="line">83</span><br><span
                                                            class="line">84</span><br><span
                                                            class="line">85</span><br><span
                                                            class="line">86</span><br><span
                                                            class="line">87</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line">    <span class="comment">//EventPublishingRunListener 类方法,该类实现SpringApplicationRunListener 接口</span></span><br><span
                                                            class="line"></span><br><span class="line"><span
                                                            class="keyword">public</span> <span class="class"><span
                                                            class="keyword">interface</span> <span class="title">SpringApplicationRunListener</span> </span>&#123;</span><br><span
                                                            class="line">    <span class="function"><span
                                                            class="keyword">void</span> <span
                                                            class="title">starting</span><span class="params">()</span></span>; <span
                                                            class="comment">//在run方法业务逻辑执行、应用上下文初始化前调用此方法</span></span><br><span
                                                            class="line"></span><br><span class="line">    <span
                                                            class="function"><span class="keyword">void</span> <span
                                                            class="title">environmentPrepared</span><span
                                                            class="params">(ConfigurableEnvironment var1)</span></span>; <span
                                                            class="comment">//当环境准备完成，应用上下文被创建之前调用此方法 读取配置文件在这个步骤进行</span></span><br><span
                                                            class="line"></span><br><span class="line">    <span
                                                            class="function"><span class="keyword">void</span> <span
                                                            class="title">contextPrepared</span><span class="params">(ConfigurableApplicationContext var1)</span></span>; <span
                                                            class="comment">//在应用上下文被创建和准备完成之后，但上下文相关代码被加载执行之前调用。</span></span><br><span
                                                            class="line">    <span class="comment">//因为上下文准备事件和上下文加载事件难以明确区分，所以这个方法一般没有具体实现。</span></span><br><span
                                                            class="line"></span><br><span class="line">    <span
                                                            class="function"><span class="keyword">void</span> <span
                                                            class="title">contextLoaded</span><span class="params">(ConfigurableApplicationContext var1)</span></span>; <span
                                                            class="comment">//当上下文加载完成之后，自定义bean完全加载完成之前调用此方法。</span></span><br><span
                                                            class="line"></span><br><span class="line">    <span
                                                            class="function"><span class="keyword">void</span> <span
                                                            class="title">finished</span><span class="params">(ConfigurableApplicationContext var1, Throwable var2)</span></span>; <span
                                                            class="comment">//当run方法执行完成，或执行过程中发现异常时调用此方法。</span></span><br><span
                                                            class="line">&#125;</span><br><span class="line"></span><br><span
                                                            class="line">    <span class="comment">//EventPublishingRunListener构造方法，将SpringApplication中的**所有**ApplicationListener放入ApplicationEventMulticaster广播器</span></span><br><span
                                                            class="line">    <span class="function"><span
                                                            class="keyword">public</span> <span class="title">EventPublishingRunListener</span><span
                                                            class="params">(SpringApplication application, String[] args)</span> </span>&#123;</span><br><span
                                                            class="line">        <span class="keyword">this</span>.application = application;</span><br><span
                                                            class="line">        <span class="keyword">this</span>.args = args;</span><br><span
                                                            class="line">        <span class="keyword">this</span>.initialMulticaster = <span
                                                            class="keyword">new</span> SimpleApplicationEventMulticaster();</span><br><span
                                                            class="line">        Iterator var3 = application.getListeners().iterator();</span><br><span
                                                            class="line"></span><br><span class="line">        <span
                                                            class="keyword">while</span>(var3.hasNext()) &#123;</span><br><span
                                                            class="line">            ApplicationListener&lt;?&gt; listener = (ApplicationListener)var3.next();</span><br><span
                                                            class="line">            <span class="keyword">this</span>.initialMulticaster.addApplicationListener(listener);</span><br><span
                                                            class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span
                                                            class="line"></span><br><span class="line">    <span
                                                            class="comment">//开始方法</span></span><br><span class="line">    <span
                                                            class="function"><span class="keyword">public</span> <span
                                                            class="keyword">void</span> <span
                                                            class="title">starting</span><span class="params">()</span> </span>&#123;</span><br><span
                                                            class="line">        <span class="keyword">this</span>.initialMulticaster.multicastEvent(<span
                                                            class="keyword">new</span> ApplicationStartedEvent(<span
                                                            class="keyword">this</span>.application, <span
                                                            class="keyword">this</span>.args)); <span class="comment">//ApplicationStartedEvent这个事件</span></span><br><span
                                                            class="line">    &#125;</span><br><span class="line"></span><br><span
                                                            class="line">    <span class="comment">//SimpleApplicationEventMulticaster方法</span></span><br><span
                                                            class="line">    <span class="function"><span
                                                            class="keyword">public</span> <span
                                                            class="keyword">void</span> <span class="title">multicastEvent</span><span
                                                            class="params">(ApplicationEvent event)</span> </span>&#123;</span><br><span
                                                            class="line">        <span class="keyword">this</span>.multicastEvent(event, <span
                                                            class="keyword">this</span>.resolveDefaultEventType(event));</span><br><span
                                                            class="line">    &#125;</span><br><span class="line"></span><br><span
                                                            class="line">    <span class="function"><span
                                                            class="keyword">public</span> <span
                                                            class="keyword">void</span> <span class="title">multicastEvent</span><span
                                                            class="params">(<span class="keyword">final</span> ApplicationEvent event, ResolvableType eventType)</span> </span>&#123;</span><br><span
                                                            class="line">        ResolvableType type = eventType != <span
                                                            class="keyword">null</span> ? eventType : <span
                                                            class="keyword">this</span>.resolveDefaultEventType(event);</span><br><span
                                                            class="line">        Iterator var4 = <span class="keyword">this</span>.getApplicationListeners(event, type).iterator();</span><br><span
                                                            class="line"></span><br><span class="line">        <span
                                                            class="keyword">while</span>(var4.hasNext()) &#123;</span><br><span
                                                            class="line">            <span class="keyword">final</span> ApplicationListener&lt;?&gt; listener = (ApplicationListener)var4.next();</span><br><span
                                                            class="line">            Executor executor = <span
                                                            class="keyword">this</span>.getTaskExecutor();</span><br><span
                                                            class="line">            <span class="keyword">if</span> (executor != <span
                                                            class="keyword">null</span>) &#123;</span><br><span
                                                            class="line">                executor.execute(<span
                                                            class="keyword">new</span> Runnable() &#123;</span><br><span
                                                            class="line">                    <span
                                                            class="function"><span class="keyword">public</span> <span
                                                            class="keyword">void</span> <span
                                                            class="title">run</span><span
                                                            class="params">()</span> </span>&#123;</span><br><span
                                                            class="line">                        SimpleApplicationEventMulticaster.<span
                                                            class="keyword">this</span>.invokeListener(listener, event);</span><br><span
                                                            class="line">                    &#125;</span><br><span
                                                            class="line">                &#125;);</span><br><span
                                                            class="line">            &#125; <span
                                                            class="keyword">else</span> &#123;</span><br><span
                                                            class="line">                <span
                                                            class="keyword">this</span>.invokeListener(listener, event);</span><br><span
                                                            class="line">            &#125;</span><br><span
                                                            class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span
                                                            class="line"></span><br><span class="line">    <span
                                                            class="function"><span
                                                            class="keyword">protected</span> <span
                                                            class="keyword">void</span> <span class="title">invokeListener</span><span
                                                            class="params">(ApplicationListener&lt;?&gt; listener, ApplicationEvent event)</span> </span>&#123;</span><br><span
                                                            class="line">        ErrorHandler errorHandler = <span
                                                            class="keyword">this</span>.getErrorHandler();</span><br><span
                                                            class="line">        <span class="keyword">if</span> (errorHandler != <span
                                                            class="keyword">null</span>) &#123;</span><br><span
                                                            class="line">            <span class="keyword">try</span> &#123;</span><br><span
                                                            class="line">                <span
                                                            class="keyword">this</span>.doInvokeListener(listener, event);</span><br><span
                                                            class="line">            &#125; <span
                                                            class="keyword">catch</span> (Throwable var5) &#123;</span><br><span
                                                            class="line">                errorHandler.handleError(var5);</span><br><span
                                                            class="line">            &#125;</span><br><span
                                                            class="line">        &#125; <span
                                                            class="keyword">else</span> &#123;</span><br><span
                                                            class="line">            <span class="keyword">this</span>.doInvokeListener(listener, event);</span><br><span
                                                            class="line">        &#125;</span><br><span
                                                            class="line"></span><br><span class="line">    &#125;</span><br><span
                                                            class="line"></span><br><span class="line">    <span
                                                            class="function"><span class="keyword">private</span> <span
                                                            class="keyword">void</span> <span class="title">doInvokeListener</span><span
                                                            class="params">(ApplicationListener listener, ApplicationEvent event)</span> </span>&#123;</span><br><span
                                                            class="line">        <span class="keyword">try</span> &#123;</span><br><span
                                                            class="line">            listener.onApplicationEvent(event); <span
                                                            class="comment">// 最后调用listener这个方法，这个方法可拓展，对应之前SpringApplication成员属性listeners</span></span><br><span
                                                            class="line">        &#125; <span
                                                            class="keyword">catch</span> (ClassCastException var6) &#123;</span><br><span
                                                            class="line">            String msg = var6.getMessage();</span><br><span
                                                            class="line">            <span class="keyword">if</span> (msg != <span
                                                            class="keyword">null</span> &amp;&amp; !msg.startsWith(event.getClass().getName())) &#123;</span><br><span
                                                            class="line">                <span
                                                            class="keyword">throw</span> var6;</span><br><span
                                                            class="line">            &#125;</span><br><span
                                                            class="line"></span><br><span class="line">            Log logger = LogFactory.getLog(<span
                                                            class="keyword">this</span>.getClass());</span><br><span
                                                            class="line">            <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span
                                                            class="line">                logger.debug(<span
                                                            class="string">"Non-matching event type for listener: "</span> + listener, var6);</span><br><span
                                                            class="line">            &#125;</span><br><span
                                                            class="line">        &#125;</span><br><span
                                                            class="line"></span><br><span class="line">    &#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h3 id="listener-onApplicationEvent-方法与SpringApplication成员属性对应"><a
                                            href="#listener-onApplicationEvent-方法与SpringApplication成员属性对应"
                                            class="headerlink"
                                            title="listener.onApplicationEvent 方法与SpringApplication成员属性对应"></a>listener.onApplicationEvent
                                        方法与SpringApplication成员属性对应</h3>
                                    <figure class="highlight java">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span
                                                            class="line">2</span><br><span
                                                            class="line">3</span><br><span
                                                            class="line">4</span><br><span
                                                            class="line">5</span><br><span
                                                            class="line">6</span><br><span
                                                            class="line">7</span><br><span
                                                            class="line">8</span><br><span
                                                            class="line">9</span><br><span
                                                            class="line">10</span><br><span
                                                            class="line">11</span><br><span
                                                            class="line">12</span><br><span
                                                            class="line">13</span><br><span
                                                            class="line">14</span><br><span
                                                            class="line">15</span><br><span
                                                            class="line">16</span><br><span
                                                            class="line">17</span><br><span
                                                            class="line">18</span><br><span
                                                            class="line">19</span><br><span
                                                            class="line">20</span><br><span
                                                            class="line">21</span><br><span
                                                            class="line">22</span><br><span
                                                            class="line">23</span><br><span
                                                            class="line">24</span><br><span
                                                            class="line">25</span><br><span
                                                            class="line">26</span><br><span
                                                            class="line">27</span><br><span
                                                            class="line">28</span><br><span
                                                            class="line">29</span><br><span
                                                            class="line">30</span><br><span
                                                            class="line">31</span><br><span
                                                            class="line">32</span><br><span
                                                            class="line">33</span><br><span
                                                            class="line">34</span><br><span
                                                            class="line">35</span><br><span
                                                            class="line">36</span><br><span
                                                            class="line">37</span><br><span
                                                            class="line">38</span><br><span
                                                            class="line">39</span><br><span
                                                            class="line">40</span><br><span
                                                            class="line">41</span><br><span
                                                            class="line">42</span><br><span
                                                            class="line">43</span><br><span
                                                            class="line">44</span><br><span
                                                            class="line">45</span><br><span
                                                            class="line">46</span><br><span
                                                            class="line">47</span><br><span
                                                            class="line">48</span><br><span
                                                            class="line">49</span><br><span
                                                            class="line">50</span><br><span
                                                            class="line">51</span><br><span
                                                            class="line">52</span><br><span
                                                            class="line">53</span><br><span
                                                            class="line">54</span><br><span
                                                            class="line">55</span><br><span
                                                            class="line">56</span><br><span
                                                            class="line">57</span><br><span
                                                            class="line">58</span><br><span
                                                            class="line">59</span><br><span
                                                            class="line">60</span><br><span
                                                            class="line">61</span><br><span
                                                            class="line">62</span><br><span
                                                            class="line">63</span><br><span
                                                            class="line">64</span><br><span
                                                            class="line">65</span><br><span
                                                            class="line">66</span><br><span
                                                            class="line">67</span><br><span
                                                            class="line">68</span><br><span
                                                            class="line">69</span><br><span
                                                            class="line">70</span><br><span
                                                            class="line">71</span><br><span
                                                            class="line">72</span><br><span
                                                            class="line">73</span><br><span
                                                            class="line">74</span><br><span
                                                            class="line">75</span><br><span
                                                            class="line">76</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"> <span class="comment">// ParentContextCloserApplicationListener </span></span><br><span
                                                            class="line"> <span class="function"><span class="keyword">public</span> <span
                                                            class="keyword">void</span> <span class="title">onApplicationEvent</span><span
                                                            class="params">(ParentContextAvailableEvent event)</span> </span>&#123;</span><br><span
                                                            class="line">     <span class="keyword">this</span>.maybeInstallListenerInParent(event.getApplicationContext());</span><br><span
                                                            class="line"> &#125;</span><br><span class="line"> <span
                                                            class="comment">//FileEncodingApplicationListener</span></span><br><span
                                                            class="line"> <span class="function"><span class="keyword">public</span> <span
                                                            class="keyword">void</span> <span class="title">onApplicationEvent</span><span
                                                            class="params">(ApplicationEnvironmentPreparedEvent event)</span> </span>&#123;</span><br><span
                                                            class="line">     RelaxedPropertyResolver resolver = <span
                                                            class="keyword">new</span> RelaxedPropertyResolver(event.getEnvironment(), <span
                                                            class="string">"spring."</span>);</span><br><span
                                                            class="line">     <span class="keyword">if</span> (resolver.containsProperty(<span
                                                            class="string">"mandatoryFileEncoding"</span>)) &#123;</span><br><span
                                                            class="line">         String encoding = System.getProperty(<span
                                                            class="string">"file.encoding"</span>);</span><br><span
                                                            class="line">         String desired = resolver.getProperty(<span
                                                            class="string">"mandatoryFileEncoding"</span>);</span><br><span
                                                            class="line">         <span class="keyword">if</span> (encoding != <span
                                                            class="keyword">null</span> &amp;&amp; !desired.equalsIgnoreCase(encoding)) &#123;</span><br><span
                                                            class="line">             logger.error(<span class="string">"System property 'file.encoding' is currently '"</span> + encoding + <span
                                                            class="string">"'. It should be '"</span> + desired + <span
                                                            class="string">"' (as defined in 'spring.mandatoryFileEncoding')."</span>);</span><br><span
                                                            class="line">             logger.error(<span class="string">"Environment variable LANG is '"</span> + System.getenv(<span
                                                            class="string">"LANG"</span>) + <span class="string">"'. You could use a locale setting that matches encoding='"</span> + desired + <span
                                                            class="string">"'."</span>);</span><br><span class="line">             logger.error(<span
                                                            class="string">"Environment variable LC_ALL is '"</span> + System.getenv(<span
                                                            class="string">"LC_ALL"</span>) + <span class="string">"'. You could use a locale setting that matches encoding='"</span> + desired + <span
                                                            class="string">"'."</span>);</span><br><span class="line">             <span
                                                            class="keyword">throw</span> <span
                                                            class="keyword">new</span> IllegalStateException(<span
                                                            class="string">"The Java Virtual Machine has not been configured to use the desired default character encoding ("</span> + desired + <span
                                                            class="string">")."</span>);</span><br><span class="line">         &#125;</span><br><span
                                                            class="line">     &#125;</span><br><span
                                                            class="line"></span><br><span
                                                            class="line"> &#125;</span><br><span
                                                            class="line"></span><br><span class="line"> <span
                                                            class="comment">//AnsiOutputApplicationListener</span></span><br><span
                                                            class="line"> <span class="function"><span class="keyword">public</span> <span
                                                            class="keyword">void</span> <span class="title">onApplicationEvent</span><span
                                                            class="params">(ApplicationEnvironmentPreparedEvent event)</span> </span>&#123;</span><br><span
                                                            class="line">     RelaxedPropertyResolver resolver = <span
                                                            class="keyword">new</span> RelaxedPropertyResolver(event.getEnvironment(), <span
                                                            class="string">"spring.output.ansi."</span>);</span><br><span
                                                            class="line">     <span class="keyword">if</span> (resolver.containsProperty(<span
                                                            class="string">"enabled"</span>)) &#123;</span><br><span
                                                            class="line">         String enabled = resolver.getProperty(<span
                                                            class="string">"enabled"</span>);</span><br><span
                                                            class="line">         AnsiOutput.setEnabled((Enabled)Enum.valueOf(Enabled.class, enabled.toUpperCase()));</span><br><span
                                                            class="line">     &#125;</span><br><span
                                                            class="line"></span><br><span class="line">     <span
                                                            class="keyword">if</span> (resolver.containsProperty(<span
                                                            class="string">"console-available"</span>)) &#123;</span><br><span
                                                            class="line">         AnsiOutput.setConsoleAvailable((Boolean)resolver.getProperty(<span
                                                            class="string">"console-available"</span>, Boolean.class));</span><br><span
                                                            class="line">     &#125;</span><br><span
                                                            class="line"></span><br><span
                                                            class="line"> &#125;</span><br><span class="line"> <span
                                                            class="comment">//ConfigFileApplicationListener ApplicationEnvironmentPreparedEvent</span></span><br><span
                                                            class="line"> <span class="function"><span class="keyword">public</span> <span
                                                            class="keyword">void</span> <span class="title">onApplicationEvent</span><span
                                                            class="params">(ApplicationEvent event)</span> </span>&#123;</span><br><span
                                                            class="line">     <span
                                                            class="keyword">if</span> (event <span class="keyword">instanceof</span> ApplicationEnvironmentPreparedEvent) &#123;</span><br><span
                                                            class="line">         <span class="keyword">this</span>.onApplicationEnvironmentPreparedEvent((ApplicationEnvironmentPreparedEvent)event);</span><br><span
                                                            class="line">     &#125;</span><br><span
                                                            class="line"></span><br><span class="line">     <span
                                                            class="keyword">if</span> (event <span class="keyword">instanceof</span> ApplicationPreparedEvent) &#123;</span><br><span
                                                            class="line">         <span class="keyword">this</span>.onApplicationPreparedEvent(event);</span><br><span
                                                            class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span
                                                            class="line"></span><br><span class="line"> <span
                                                            class="comment">//DelegatingApplicationListener 监控ApplicationEnvironmentPreparedEvent</span></span><br><span
                                                            class="line"></span><br><span class="line"> <span
                                                            class="function"><span class="keyword">public</span> <span
                                                            class="keyword">void</span> <span class="title">onApplicationEvent</span><span
                                                            class="params">(ApplicationEvent event)</span> </span>&#123;</span><br><span
                                                            class="line">     <span
                                                            class="keyword">if</span> (event <span class="keyword">instanceof</span> ApplicationEnvironmentPreparedEvent) &#123;</span><br><span
                                                            class="line">         List&lt;ApplicationListener&lt;ApplicationEvent&gt;&gt; delegates = <span
                                                            class="keyword">this</span>.getListeners(((ApplicationEnvironmentPreparedEvent)event).getEnvironment());</span><br><span
                                                            class="line">         <span class="keyword">if</span> (delegates.isEmpty()) &#123;</span><br><span
                                                            class="line">             <span
                                                            class="keyword">return</span>;</span><br><span class="line">         &#125;</span><br><span
                                                            class="line"></span><br><span class="line">         <span
                                                            class="keyword">this</span>.multicaster = <span
                                                            class="keyword">new</span> SimpleApplicationEventMulticaster();</span><br><span
                                                            class="line">         Iterator var3 = delegates.iterator();</span><br><span
                                                            class="line"></span><br><span class="line">         <span
                                                            class="keyword">while</span>(var3.hasNext()) &#123;</span><br><span
                                                            class="line">             ApplicationListener&lt;ApplicationEvent&gt; listener = (ApplicationListener)var3.next();</span><br><span
                                                            class="line">             <span class="keyword">this</span>.multicaster.addApplicationListener(listener);</span><br><span
                                                            class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span
                                                            class="line"></span><br><span class="line">     <span
                                                            class="keyword">if</span> (<span class="keyword">this</span>.multicaster != <span
                                                            class="keyword">null</span>) &#123;</span><br><span
                                                            class="line">         <span class="keyword">this</span>.multicaster.multicastEvent(event);</span><br><span
                                                            class="line">     &#125;</span><br><span
                                                            class="line"></span><br><span
                                                            class="line"> &#125;</span><br><span
                                                            class="line"></span><br><span class="line"> <span
                                                            class="comment">//LiquibaseServiceLocatorApplicationListener  这个与上面创建的事件对应，都是ApplicationStartingEvent，所以会执行</span></span><br><span
                                                            class="line"> <span class="function"><span class="keyword">public</span> <span
                                                            class="keyword">void</span> <span class="title">onApplicationEvent</span><span
                                                            class="params">(ApplicationStartingEvent event)</span> </span>&#123;</span><br><span
                                                            class="line">     <span class="keyword">if</span> (ClassUtils.isPresent(<span
                                                            class="string">"liquibase.servicelocator.ServiceLocator"</span>, (ClassLoader)<span
                                                            class="keyword">null</span>)) &#123;</span><br><span
                                                            class="line">         (<span class="keyword">new</span> LiquibaseServiceLocatorApplicationListener.LiquibasePresent()).replaceServiceLocator();</span><br><span
                                                            class="line">     &#125;</span><br><span
                                                            class="line"></span><br><span
                                                            class="line"> &#125;</span><br><span class="line"><span
                                                            class="comment">//其他Listener省略</span></span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h3 id="自定义ApplicationListener，用于初始化后执行特定方法原理"><a
                                            href="#自定义ApplicationListener，用于初始化后执行特定方法原理" class="headerlink"
                                            title="自定义ApplicationListener，用于初始化后执行特定方法原理"></a>自定义ApplicationListener，用于初始化后执行特定方法原理
                                    </h3>
                                    <p>创建JavaBean实现ApplicationListener
                                        <e extends="" applicationevent="">
                                            在容器启动时，坚持容器中所有ApplicationListener并将注册到SimpleApplicationEventMulticaster集合中，在
                                            SimpleApplicationEventMulticaster 中，可以看到 multicastEvent 方法中遍历了所有的
                                            Listener，并依次调用 Listener 的 onApplicationEvent 方法发布事件。
                                        </e>
                                    </p>
                                    <h2 id="prepareEnvironment方法"><a href="#prepareEnvironment方法" class="headerlink"
                                                                     title="prepareEnvironment方法"></a>prepareEnvironment方法
                                    </h2>
                                    <h2 id="在Context创建前准备环境"><a href="#在Context创建前准备环境" class="headerlink"
                                                                title="在Context创建前准备环境"></a>在Context创建前准备环境</h2>
                                    <figure class="highlight java">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span
                                                            class="line">2</span><br><span
                                                            class="line">3</span><br><span
                                                            class="line">4</span><br><span
                                                            class="line">5</span><br><span
                                                            class="line">6</span><br><span
                                                            class="line">7</span><br><span
                                                            class="line">8</span><br><span
                                                            class="line">9</span><br><span
                                                            class="line">10</span><br><span
                                                            class="line">11</span><br><span
                                                            class="line">12</span><br><span
                                                            class="line">13</span><br><span
                                                            class="line">14</span><br><span
                                                            class="line">15</span><br><span
                                                            class="line">16</span><br><span
                                                            class="line">17</span><br><span
                                                            class="line">18</span><br><span
                                                            class="line">19</span><br><span
                                                            class="line">20</span><br><span
                                                            class="line">21</span><br><span
                                                            class="line">22</span><br><span
                                                            class="line">23</span><br><span
                                                            class="line">24</span><br><span
                                                            class="line">25</span><br><span
                                                            class="line">26</span><br><span
                                                            class="line">27</span><br><span
                                                            class="line">28</span><br><span
                                                            class="line">29</span><br><span
                                                            class="line">30</span><br><span
                                                            class="line">31</span><br><span
                                                            class="line">32</span><br><span
                                                            class="line">33</span><br><span
                                                            class="line">34</span><br><span
                                                            class="line">35</span><br><span
                                                            class="line">36</span><br><span
                                                            class="line">37</span><br><span
                                                            class="line">38</span><br><span
                                                            class="line">39</span><br><span
                                                            class="line">40</span><br><span
                                                            class="line">41</span><br><span
                                                            class="line">42</span><br><span
                                                            class="line">43</span><br><span
                                                            class="line">44</span><br><span
                                                            class="line">45</span><br><span
                                                            class="line">46</span><br><span
                                                            class="line">47</span><br><span
                                                            class="line">48</span><br><span
                                                            class="line">49</span><br><span
                                                            class="line">50</span><br><span
                                                            class="line">51</span><br><span
                                                            class="line">52</span><br><span
                                                            class="line">53</span><br><span
                                                            class="line">54</span><br><span
                                                            class="line">55</span><br><span
                                                            class="line">56</span><br><span
                                                            class="line">57</span><br><span
                                                            class="line">58</span><br><span
                                                            class="line">59</span><br><span
                                                            class="line">60</span><br><span
                                                            class="line">61</span><br><span
                                                            class="line">62</span><br><span
                                                            class="line">63</span><br><span
                                                            class="line">64</span><br><span
                                                            class="line">65</span><br><span
                                                            class="line">66</span><br><span
                                                            class="line">67</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span
                                                            class="comment">//SpringApplication </span></span><br><span
                                                            class="line"> <span class="function"><span class="keyword">private</span> ConfigurableEnvironment <span
                                                            class="title">prepareEnvironment</span><span class="params">(SpringApplicationRunListeners listeners, ApplicationArguments applicationArguments)</span> </span>&#123;</span><br><span
                                                            class="line">     ConfigurableEnvironment environment = <span
                                                            class="keyword">this</span>.getOrCreateEnvironment();</span><br><span
                                                            class="line">     <span class="keyword">this</span>.configureEnvironment((ConfigurableEnvironment)environment, applicationArguments.getSourceArgs());</span><br><span
                                                            class="line">     listeners.environmentPrepared((ConfigurableEnvironment)environment);  <span
                                                            class="comment">//注意 配置</span></span><br><span class="line">     <span
                                                            class="comment">// 此时发布ApplicationEnvironmentPreparedEvent事件，这一步读取配置文件</span></span><br><span
                                                            class="line">     <span class="keyword">if</span> (!<span
                                                            class="keyword">this</span>.webEnvironment) &#123;</span><br><span
                                                            class="line">         environment = (<span class="keyword">new</span> EnvironmentConverter(<span
                                                            class="keyword">this</span>.getClassLoader())).convertToStandardEnvironmentIfNecessary((ConfigurableEnvironment)environment);</span><br><span
                                                            class="line">     &#125;</span><br><span
                                                            class="line"></span><br><span class="line">     <span
                                                            class="keyword">return</span> (ConfigurableEnvironment)environment;</span><br><span
                                                            class="line"> &#125;</span><br><span
                                                            class="line"></span><br><span class="line"> <span
                                                            class="function"><span
                                                            class="keyword">protected</span> <span
                                                            class="keyword">void</span> <span class="title">configureEnvironment</span><span
                                                            class="params">(ConfigurableEnvironment environment, String[] args)</span> </span>&#123;</span><br><span
                                                            class="line">     <span
                                                            class="comment">//配置属性源</span></span><br><span class="line">     <span
                                                            class="keyword">this</span>.configurePropertySources(environment, args);</span><br><span
                                                            class="line">     <span
                                                            class="comment">//配置profile</span></span><br><span
                                                            class="line">     <span class="keyword">this</span>.configureProfiles(environment, args);</span><br><span
                                                            class="line"> &#125;</span><br><span
                                                            class="line"></span><br><span class="line"> <span
                                                            class="function"><span
                                                            class="keyword">protected</span> <span
                                                            class="keyword">void</span> <span class="title">configurePropertySources</span><span
                                                            class="params">(ConfigurableEnvironment environment, String[] args)</span> </span>&#123;</span><br><span
                                                            class="line">     MutablePropertySources sources = environment.getPropertySources();</span><br><span
                                                            class="line">     <span class="keyword">if</span> (<span
                                                            class="keyword">this</span>.defaultProperties != <span
                                                            class="keyword">null</span> &amp;&amp; !<span
                                                            class="keyword">this</span>.defaultProperties.isEmpty()) &#123;</span><br><span
                                                            class="line">         sources.addLast(<span class="keyword">new</span> MapPropertySource(<span
                                                            class="string">"defaultProperties"</span>, <span
                                                            class="keyword">this</span>.defaultProperties));</span><br><span
                                                            class="line">     &#125;</span><br><span
                                                            class="line"></span><br><span class="line">     <span
                                                            class="keyword">if</span> (<span class="keyword">this</span>.addCommandLineProperties &amp;&amp; args.length &gt; <span
                                                            class="number">0</span>) &#123;</span><br><span
                                                            class="line">         String name = <span class="string">"commandLineArgs"</span>;</span><br><span
                                                            class="line">         <span class="keyword">if</span> (sources.contains(name)) &#123;</span><br><span
                                                            class="line">             PropertySource&lt;?&gt; source = sources.get(name);</span><br><span
                                                            class="line">             CompositePropertySource composite = <span
                                                            class="keyword">new</span> CompositePropertySource(name);</span><br><span
                                                            class="line">             composite.addPropertySource(<span
                                                            class="keyword">new</span> SimpleCommandLinePropertySource(name + <span
                                                            class="string">"-"</span> + args.hashCode(), args));</span><br><span
                                                            class="line">             composite.addPropertySource(source);</span><br><span
                                                            class="line">             sources.replace(name, composite);</span><br><span
                                                            class="line">         &#125; <span
                                                            class="keyword">else</span> &#123;</span><br><span
                                                            class="line">             sources.addFirst(<span
                                                            class="keyword">new</span> SimpleCommandLinePropertySource(args));</span><br><span
                                                            class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span
                                                            class="line"></span><br><span
                                                            class="line"> &#125;</span><br><span
                                                            class="line"></span><br><span class="line"></span><br><span
                                                            class="line"> <span class="function"><span class="keyword">protected</span> <span
                                                            class="keyword">void</span> <span class="title">configureProfiles</span><span
                                                            class="params">(ConfigurableEnvironment environment, String[] args)</span> </span>&#123;</span><br><span
                                                            class="line">     environment.getActiveProfiles();</span><br><span
                                                            class="line">     Set&lt;String&gt; profiles = <span
                                                            class="keyword">new</span> LinkedHashSet(<span
                                                            class="keyword">this</span>.additionalProfiles);</span><br><span
                                                            class="line">     profiles.addAll(Arrays.asList(environment.getActiveProfiles()));</span><br><span
                                                            class="line">     environment.setActiveProfiles((String[])profiles.toArray(<span
                                                            class="keyword">new</span> String[profiles.size()]));</span><br><span
                                                            class="line"> &#125;</span><br><span
                                                            class="line"></span><br><span class="line"> <span
                                                            class="comment">// AbstractEnvironment </span></span><br><span
                                                            class="line"> <span class="keyword">public</span> String[] getActiveProfiles() &#123;</span><br><span
                                                            class="line">     <span class="keyword">return</span> StringUtils.toStringArray(<span
                                                            class="keyword">this</span>.doGetActiveProfiles());</span><br><span
                                                            class="line"> &#125;</span><br><span
                                                            class="line"></span><br><span class="line"> <span
                                                            class="function"><span class="keyword">protected</span> Set&lt;String&gt; <span
                                                            class="title">doGetActiveProfiles</span><span
                                                            class="params">()</span> </span>&#123;</span><br><span
                                                            class="line">     Set var1 = <span
                                                            class="keyword">this</span>.activeProfiles;</span><br><span
                                                            class="line">     <span class="keyword">synchronized</span>(<span
                                                            class="keyword">this</span>.activeProfiles) &#123;</span><br><span
                                                            class="line">         <span class="keyword">if</span> (<span
                                                            class="keyword">this</span>.activeProfiles.isEmpty()) &#123;</span><br><span
                                                            class="line">             String profiles = <span
                                                            class="keyword">this</span>.getProperty(<span
                                                            class="string">"spring.profiles.active"</span>);  <span
                                                            class="comment">//系统配置 通过配置决定使用哪个配置文件</span></span><br><span
                                                            class="line">             <span class="keyword">if</span> (StringUtils.hasText(profiles)) &#123;</span><br><span
                                                            class="line">                 <span
                                                            class="keyword">this</span>.setActiveProfiles(StringUtils.commaDelimitedListToStringArray(StringUtils.trimAllWhitespace(profiles)));</span><br><span
                                                            class="line">             &#125;</span><br><span
                                                            class="line">         &#125;</span><br><span
                                                            class="line"></span><br><span class="line">         <span
                                                            class="keyword">return</span> <span
                                                            class="keyword">this</span>.activeProfiles;</span><br><span
                                                            class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h3 id="listeners-environmentPrepared-ConfigurableEnvironment-environment-方法"><a
                                            href="#listeners-environmentPrepared-ConfigurableEnvironment-environment-方法"
                                            class="headerlink"
                                            title="listeners.environmentPrepared((ConfigurableEnvironment)environment)方法"></a>listeners.environmentPrepared((ConfigurableEnvironment)environment)方法
                                    </h3>
                                    <figure class="highlight java">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span
                                                            class="line">2</span><br><span
                                                            class="line">3</span><br><span
                                                            class="line">4</span><br><span
                                                            class="line">5</span><br><span
                                                            class="line">6</span><br><span
                                                            class="line">7</span><br><span
                                                            class="line">8</span><br><span
                                                            class="line">9</span><br><span
                                                            class="line">10</span><br><span
                                                            class="line">11</span><br><span
                                                            class="line">12</span><br><span
                                                            class="line">13</span><br><span
                                                            class="line">14</span><br><span
                                                            class="line">15</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="comment">//SpringApplicationRunListeners</span></span><br><span
                                                            class="line"><span class="function"><span class="keyword">public</span> <span
                                                            class="keyword">void</span> <span class="title">environmentPrepared</span><span
                                                            class="params">(ConfigurableEnvironment environment)</span> </span>&#123;</span><br><span
                                                            class="line">    Iterator var2 = <span
                                                            class="keyword">this</span>.listeners.iterator();</span><br><span
                                                            class="line"></span><br><span class="line">    <span
                                                            class="keyword">while</span>(var2.hasNext()) &#123;</span><br><span
                                                            class="line">        SpringApplicationRunListener listener = (SpringApplicationRunListener)var2.next();</span><br><span
                                                            class="line">        listener.environmentPrepared(environment);</span><br><span
                                                            class="line">    &#125;</span><br><span class="line"></span><br><span
                                                            class="line">&#125;</span><br><span class="line"></span><br><span
                                                            class="line"><span class="comment">//EventPublishingRunListener</span></span><br><span
                                                            class="line"><span class="function"><span class="keyword">public</span> <span
                                                            class="keyword">void</span> <span class="title">environmentPrepared</span><span
                                                            class="params">(ConfigurableEnvironment environment)</span> </span>&#123;</span><br><span
                                                            class="line">    <span class="keyword">this</span>.initialMulticaster.multicastEvent(<span
                                                            class="keyword">new</span> ApplicationEnvironmentPreparedEvent(<span
                                                            class="keyword">this</span>.application, <span
                                                            class="keyword">this</span>.args, environment));<span
                                                            class="comment">//创建事件类型为ApplicationEnvironmentPreparedEvent</span></span><br><span
                                                            class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>
                                        上面代码创建ApplicationEnvironmentPreparedEvent，ConfigFileApplicationListener监听响应这个事件</p>
                                    <figure class="highlight java">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span
                                                            class="line">2</span><br><span
                                                            class="line">3</span><br><span
                                                            class="line">4</span><br><span
                                                            class="line">5</span><br><span
                                                            class="line">6</span><br><span
                                                            class="line">7</span><br><span
                                                            class="line">8</span><br><span
                                                            class="line">9</span><br><span
                                                            class="line">10</span><br><span
                                                            class="line">11</span><br><span
                                                            class="line">12</span><br><span
                                                            class="line">13</span><br><span
                                                            class="line">14</span><br><span
                                                            class="line">15</span><br><span
                                                            class="line">16</span><br><span
                                                            class="line">17</span><br><span
                                                            class="line">18</span><br><span
                                                            class="line">19</span><br><span
                                                            class="line">20</span><br><span
                                                            class="line">21</span><br><span
                                                            class="line">22</span><br><span
                                                            class="line">23</span><br><span
                                                            class="line">24</span><br><span
                                                            class="line">25</span><br><span
                                                            class="line">26</span><br><span
                                                            class="line">27</span><br><span
                                                            class="line">28</span><br><span
                                                            class="line">29</span><br><span
                                                            class="line">30</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="comment">//ConfigFileApplicationListener</span></span><br><span
                                                            class="line"><span class="function"><span class="keyword">public</span> <span
                                                            class="keyword">void</span> <span class="title">onApplicationEvent</span><span
                                                            class="params">(ApplicationEvent event)</span> </span>&#123;</span><br><span
                                                            class="line">    <span
                                                            class="keyword">if</span> (event <span class="keyword">instanceof</span> ApplicationEnvironmentPreparedEvent) &#123;</span><br><span
                                                            class="line">        <span class="keyword">this</span>.onApplicationEnvironmentPreparedEvent((ApplicationEnvironmentPreparedEvent)event);</span><br><span
                                                            class="line">    &#125;</span><br><span class="line"></span><br><span
                                                            class="line">    <span
                                                            class="keyword">if</span> (event <span class="keyword">instanceof</span> ApplicationPreparedEvent) &#123;</span><br><span
                                                            class="line">        <span class="keyword">this</span>.onApplicationPreparedEvent(event);</span><br><span
                                                            class="line">    &#125;</span><br><span class="line"></span><br><span
                                                            class="line">&#125;</span><br><span class="line"></span><br><span
                                                            class="line"></span><br><span class="line"></span><br><span
                                                            class="line"><span class="function"><span class="keyword">private</span> <span
                                                            class="keyword">void</span> <span class="title">onApplicationEnvironmentPreparedEvent</span><span
                                                            class="params">(ApplicationEnvironmentPreparedEvent event)</span> </span>&#123;</span><br><span
                                                            class="line">    List&lt;EnvironmentPostProcessor&gt; postProcessors = <span
                                                            class="keyword">this</span>.loadPostProcessors(); <span
                                                            class="comment">//</span></span><br><span class="line">    postProcessors.add(<span
                                                            class="keyword">this</span>);</span><br><span class="line">    AnnotationAwareOrderComparator.sort(postProcessors);</span><br><span
                                                            class="line">    Iterator var3 = postProcessors.iterator();</span><br><span
                                                            class="line"></span><br><span class="line">    <span
                                                            class="keyword">while</span>(var3.hasNext()) &#123;</span><br><span
                                                            class="line">        EnvironmentPostProcessor postProcessor = (EnvironmentPostProcessor)var3.next();</span><br><span
                                                            class="line">        postProcessor.postProcessEnvironment(event.getEnvironment(), event.getSpringApplication());</span><br><span
                                                            class="line">    &#125;</span><br><span class="line"></span><br><span
                                                            class="line">&#125;</span><br><span class="line"></span><br><span
                                                            class="line"><span class="function">List&lt;EnvironmentPostProcessor&gt; <span
                                                            class="title">loadPostProcessors</span><span class="params">()</span> </span>&#123;</span><br><span
                                                            class="line">    <span class="keyword">return</span> SpringFactoriesLoader.loadFactories(EnvironmentPostProcessor.class, <span
                                                            class="keyword">this</span>.getClass().getClassLoader());</span><br><span
                                                            class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>加载EnvironmentPostProcessor </p>
                                    <figure class="highlight plain">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span
                                                            class="line">2</span><br><span
                                                            class="line">3</span><br><span
                                                            class="line">4</span><br><span
                                                            class="line">5</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"></span><br><span class="line"># Environment Post Processors</span><br><span
                                                            class="line">org.springframework.boot.env.EnvironmentPostProcessor=\</span><br><span
                                                            class="line">org.springframework.boot.cloud.CloudFoundryVcapEnvironmentPostProcessor,\</span><br><span
                                                            class="line">org.springframework.boot.env.SpringApplicationJsonEnvironmentPostProcessor</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>LoggingApplicationListener同样响应这个事件，对LogbackLoggingSystem初始化工作，具体未知</p>
                                    <figure class="highlight java">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span
                                                            class="line">2</span><br><span
                                                            class="line">3</span><br><span
                                                            class="line">4</span><br><span
                                                            class="line">5</span><br><span
                                                            class="line">6</span><br><span
                                                            class="line">7</span><br><span
                                                            class="line">8</span><br><span
                                                            class="line">9</span><br><span
                                                            class="line">10</span><br><span
                                                            class="line">11</span><br><span
                                                            class="line">12</span><br><span
                                                            class="line">13</span><br><span
                                                            class="line">14</span><br><span
                                                            class="line">15</span><br><span
                                                            class="line">16</span><br><span
                                                            class="line">17</span><br><span
                                                            class="line">18</span><br><span
                                                            class="line">19</span><br><span
                                                            class="line">20</span><br><span
                                                            class="line">21</span><br><span
                                                            class="line">22</span><br><span
                                                            class="line">23</span><br><span
                                                            class="line">24</span><br><span
                                                            class="line">25</span><br><span
                                                            class="line">26</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="comment">// LoggingApplicationListener  加载log日志打印，具体未知</span></span><br><span
                                                            class="line"><span class="function"><span class="keyword">private</span> <span
                                                            class="keyword">void</span> <span class="title">onApplicationStartingEvent</span><span
                                                            class="params">(ApplicationStartingEvent event)</span> </span>&#123;</span><br><span
                                                            class="line">    <span class="keyword">this</span>.loggingSystem = LoggingSystem.get(event.getSpringApplication().getClassLoader());</span><br><span
                                                            class="line">    <span class="keyword">this</span>.loggingSystem.beforeInitialize();</span><br><span
                                                            class="line">&#125;</span><br><span class="line"></span><br><span
                                                            class="line"><span class="function"><span class="keyword">private</span> <span
                                                            class="keyword">void</span> <span class="title">onApplicationEnvironmentPreparedEvent</span><span
                                                            class="params">(ApplicationEnvironmentPreparedEvent event)</span> </span>&#123;</span><br><span
                                                            class="line">    <span class="keyword">if</span> (<span
                                                            class="keyword">this</span>.loggingSystem == <span
                                                            class="keyword">null</span>) &#123;</span><br><span
                                                            class="line">        <span class="keyword">this</span>.loggingSystem = LoggingSystem.get(event.getSpringApplication().getClassLoader());</span><br><span
                                                            class="line">    &#125;</span><br><span class="line"></span><br><span
                                                            class="line">    <span class="keyword">this</span>.initialize(event.getEnvironment(), event.getSpringApplication().getClassLoader());</span><br><span
                                                            class="line">&#125;</span><br><span class="line"></span><br><span
                                                            class="line"><span class="function"><span class="keyword">protected</span> <span
                                                            class="keyword">void</span> <span
                                                            class="title">initialize</span><span class="params">(ConfigurableEnvironment environment, ClassLoader classLoader)</span> </span>&#123;</span><br><span
                                                            class="line">    (<span class="keyword">new</span> LoggingSystemProperties(environment)).apply();</span><br><span
                                                            class="line">    LogFile logFile = LogFile.get(environment);</span><br><span
                                                            class="line">    <span class="keyword">if</span> (logFile != <span
                                                            class="keyword">null</span>) &#123;</span><br><span
                                                            class="line">        logFile.applyToSystemProperties();</span><br><span
                                                            class="line">    &#125;</span><br><span class="line"></span><br><span
                                                            class="line">    <span class="keyword">this</span>.initializeEarlyLoggingLevel(environment);</span><br><span
                                                            class="line">    <span class="keyword">this</span>.initializeSystem(environment, <span
                                                            class="keyword">this</span>.loggingSystem, logFile);</span><br><span
                                                            class="line">    <span class="keyword">this</span>.initializeFinalLoggingLevels(environment, <span
                                                            class="keyword">this</span>.loggingSystem);</span><br><span
                                                            class="line">    <span class="keyword">this</span>.registerShutdownHookIfNecessary(environment, <span
                                                            class="keyword">this</span>.loggingSystem);</span><br><span
                                                            class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h2 id="createApplicationContext-创建上下文-判断是否为web环境，通常为web项目，只分析web环境及返回AnnotationConfigEmbeddedWebApplicationContext">
                                        <a href="#createApplicationContext-创建上下文-判断是否为web环境，通常为web项目，只分析web环境及返回AnnotationConfigEmbeddedWebApplicationContext"
                                           class="headerlink"
                                           title="createApplicationContext() 创建上下文,判断是否为web环境，通常为web项目，只分析web环境及返回AnnotationConfigEmbeddedWebApplicationContext"></a>createApplicationContext()
                                        创建上下文,判断是否为web环境，通常为web项目，只分析web环境及返回AnnotationConfigEmbeddedWebApplicationContext
                                    </h2>
                                    <figure class="highlight java">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span
                                                            class="line">2</span><br><span
                                                            class="line">3</span><br><span
                                                            class="line">4</span><br><span
                                                            class="line">5</span><br><span
                                                            class="line">6</span><br><span
                                                            class="line">7</span><br><span
                                                            class="line">8</span><br><span
                                                            class="line">9</span><br><span
                                                            class="line">10</span><br><span
                                                            class="line">11</span><br><span
                                                            class="line">12</span><br><span
                                                            class="line">13</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"></span><br><span class="line"><span
                                                            class="function"><span class="keyword">protected</span> ConfigurableApplicationContext <span
                                                            class="title">createApplicationContext</span><span
                                                            class="params">()</span> </span>&#123;</span><br><span
                                                            class="line">    Class&lt;?&gt; contextClass = <span
                                                            class="keyword">this</span>.applicationContextClass;</span><br><span
                                                            class="line">    <span class="keyword">if</span> (contextClass == <span
                                                            class="keyword">null</span>) &#123;</span><br><span
                                                            class="line">        <span class="keyword">try</span> &#123;</span><br><span
                                                            class="line">            contextClass = Class.forName(<span
                                                            class="keyword">this</span>.webEnvironment ? <span
                                                            class="string">"org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext"</span> : <span
                                                            class="string">"org.springframework.context.annotation.AnnotationConfigApplicationContext"</span>);</span><br><span
                                                            class="line">        &#125; <span
                                                            class="keyword">catch</span> (ClassNotFoundException var3) &#123;</span><br><span
                                                            class="line">            <span class="keyword">throw</span> <span
                                                            class="keyword">new</span> IllegalStateException(<span
                                                            class="string">"Unable create a default ApplicationContext, please specify an ApplicationContextClass"</span>, var3);</span><br><span
                                                            class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span
                                                            class="line"></span><br><span class="line">    <span
                                                            class="keyword">return</span> (ConfigurableApplicationContext)BeanUtils.instantiate(contextClass);</span><br><span
                                                            class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <p>AnnotationConfigEmbeddedWebApplicationContext 类图如下所示<br><img
                                            src="/images/springboot/webApplicationContext.jpg" alt="webapplication"></p>
                                    <p>AnnotationConfigEmbeddedWebApplicationContext构造方法如下 ,通过以下代码得知，只是为成员变量赋值<br>
                                    <figure class="highlight java">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span
                                                            class="line">2</span><br><span
                                                            class="line">3</span><br><span
                                                            class="line">4</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="function"><span
                                                            class="keyword">public</span> <span class="title">AnnotationConfigEmbeddedWebApplicationContext</span><span
                                                            class="params">()</span> </span>&#123;</span><br><span
                                                            class="line">    <span class="keyword">this</span>.reader = <span
                                                            class="keyword">new</span> AnnotatedBeanDefinitionReader(<span
                                                            class="keyword">this</span>); </span><br><span class="line">    <span
                                                            class="keyword">this</span>.scanner = <span class="keyword">new</span> ClassPathBeanDefinitionScanner(<span
                                                            class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    </p>
                                    <p>AnnotatedBeanDefinitionReader 解析并读取BeanDefinition<br>ClassPathBeanDefinitionScanner
                                        用于扫描classpath目录下带注解的beanclass</p>
                                    <h2 id="接着上面prepareContext方法"><a href="#接着上面prepareContext方法" class="headerlink"
                                                                     title="接着上面prepareContext方法"></a>接着上面prepareContext方法
                                    </h2>
                                    <figure class="highlight java">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span
                                                            class="line">2</span><br><span
                                                            class="line">3</span><br><span
                                                            class="line">4</span><br><span
                                                            class="line">5</span><br><span
                                                            class="line">6</span><br><span
                                                            class="line">7</span><br><span
                                                            class="line">8</span><br><span
                                                            class="line">9</span><br><span
                                                            class="line">10</span><br><span
                                                            class="line">11</span><br><span
                                                            class="line">12</span><br><span
                                                            class="line">13</span><br><span
                                                            class="line">14</span><br><span
                                                            class="line">15</span><br><span
                                                            class="line">16</span><br><span
                                                            class="line">17</span><br><span
                                                            class="line">18</span><br><span
                                                            class="line">19</span><br><span
                                                            class="line">20</span><br><span
                                                            class="line">21</span><br><span
                                                            class="line">22</span><br><span
                                                            class="line">23</span><br><span
                                                            class="line">24</span><br><span
                                                            class="line">25</span><br><span
                                                            class="line">26</span><br><span
                                                            class="line">27</span><br><span
                                                            class="line">28</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"></span><br><span class="line"><span
                                                            class="function"><span class="keyword">private</span> <span
                                                            class="keyword">void</span> <span class="title">prepareContext</span><span
                                                            class="params">(ConfigurableApplicationContext context, ConfigurableEnvironment environment, SpringApplicationRunListeners listeners, ApplicationArguments applicationArguments, Banner printedBanner)</span> </span>&#123;</span><br><span
                                                            class="line">    context.setEnvironment(environment); <span
                                                            class="comment">//将环境赋值与context</span></span><br><span
                                                            class="line">    <span class="keyword">this</span>.postProcessApplicationContext(context);</span><br><span
                                                            class="line">    <span class="keyword">this</span>.applyInitializers(context); </span><br><span
                                                            class="line">    listeners.contextPrepared(context); <span
                                                            class="comment">//调用ApplicationPreparedEvent</span></span><br><span
                                                            class="line">    <span class="keyword">if</span> (<span
                                                            class="keyword">this</span>.logStartupInfo) &#123;</span><br><span
                                                            class="line">        <span class="keyword">this</span>.logStartupInfo(context.getParent() == <span
                                                            class="keyword">null</span>);</span><br><span class="line">        <span
                                                            class="keyword">this</span>.logStartupProfileInfo(context);</span><br><span
                                                            class="line">    &#125;</span><br><span class="line"></span><br><span
                                                            class="line">    context.getBeanFactory().registerSingleton(<span
                                                            class="string">"springApplicationArguments"</span>, applicationArguments);</span><br><span
                                                            class="line">    <span class="keyword">if</span> (printedBanner != <span
                                                            class="keyword">null</span>) &#123;</span><br><span
                                                            class="line">        context.getBeanFactory().registerSingleton(<span
                                                            class="string">"springBootBanner"</span>, printedBanner);</span><br><span
                                                            class="line">    &#125;</span><br><span class="line"></span><br><span
                                                            class="line">    Set&lt;Object&gt; sources = <span
                                                            class="keyword">this</span>.getSources();</span><br><span
                                                            class="line">    Assert.notEmpty(sources, <span
                                                            class="string">"Sources must not be empty"</span>);</span><br><span
                                                            class="line">    <span class="keyword">this</span>.load(context, sources.toArray(<span
                                                            class="keyword">new</span> Object[sources.size()]));</span><br><span
                                                            class="line">    listeners.contextLoaded(context);<span
                                                            class="comment">//调用ApplicationPreparedEvent</span></span><br><span
                                                            class="line">&#125;</span><br><span class="line"></span><br><span
                                                            class="line"><span class="comment">// AnnotationConfigEmbeddedWebApplicationContext 环境赋值</span></span><br><span
                                                            class="line"><span class="function"><span class="keyword">public</span> <span
                                                            class="keyword">void</span> <span class="title">setEnvironment</span><span
                                                            class="params">(ConfigurableEnvironment environment)</span> </span>&#123;</span><br><span
                                                            class="line">    <span class="keyword">super</span>.setEnvironment(environment);</span><br><span
                                                            class="line">    <span class="keyword">this</span>.reader.setEnvironment(environment);</span><br><span
                                                            class="line">    <span class="keyword">this</span>.scanner.setEnvironment(environment);</span><br><span
                                                            class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h3 id="listeners-contextPrepared-context-方法"><a
                                            href="#listeners-contextPrepared-context-方法" class="headerlink"
                                            title="listeners.contextPrepared(context)方法"></a>listeners.contextPrepared(context)方法
                                    </h3>
                                    <figure class="highlight java">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span
                                                            class="line">2</span><br><span
                                                            class="line">3</span><br><span
                                                            class="line">4</span><br><span
                                                            class="line">5</span><br><span
                                                            class="line">6</span><br><span
                                                            class="line">7</span><br><span
                                                            class="line">8</span><br><span
                                                            class="line">9</span><br><span
                                                            class="line">10</span><br><span
                                                            class="line">11</span><br><span
                                                            class="line">12</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="comment">//SpringApplicationRunListeners</span></span><br><span
                                                            class="line"><span class="function"><span class="keyword">public</span> <span
                                                            class="keyword">void</span> <span class="title">contextPrepared</span><span
                                                            class="params">(ConfigurableApplicationContext context)</span> </span>&#123;</span><br><span
                                                            class="line">    Iterator var2 = <span
                                                            class="keyword">this</span>.listeners.iterator();</span><br><span
                                                            class="line"></span><br><span class="line">    <span
                                                            class="keyword">while</span>(var2.hasNext()) &#123;</span><br><span
                                                            class="line">        SpringApplicationRunListener listener = (SpringApplicationRunListener)var2.next();</span><br><span
                                                            class="line">        listener.contextPrepared(context);</span><br><span
                                                            class="line">    &#125;</span><br><span
                                                            class="line">&#125;</span><br><span class="line"> <span
                                                            class="comment">//EventPublishingRunListener 空方法</span></span><br><span
                                                            class="line"><span class="function"><span class="keyword">public</span> <span
                                                            class="keyword">void</span> <span class="title">contextPrepared</span><span
                                                            class="params">(ConfigurableApplicationContext context)</span> </span>&#123;</span><br><span
                                                            class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>
                                    <h3 id="isteners-contextLoaded-context"><a href="#isteners-contextLoaded-context"
                                                                               class="headerlink"
                                                                               title="isteners.contextLoaded(context);"></a>isteners.contextLoaded(context);
                                    </h3>
                                    <figure class="highlight java">
                                        <table>
                                            <tr>
                                                <td class="gutter">
                                                    <pre><span class="line">1</span><br><span
                                                            class="line">2</span><br><span
                                                            class="line">3</span><br><span
                                                            class="line">4</span><br><span
                                                            class="line">5</span><br><span
                                                            class="line">6</span><br><span
                                                            class="line">7</span><br><span
                                                            class="line">8</span><br><span
                                                            class="line">9</span><br><span
                                                            class="line">10</span><br><span
                                                            class="line">11</span><br><span
                                                            class="line">12</span><br><span
                                                            class="line">13</span><br><span
                                                            class="line">14</span><br><span
                                                            class="line">15</span><br><span
                                                            class="line">16</span><br><span
                                                            class="line">17</span><br><span
                                                            class="line">18</span><br><span
                                                            class="line">19</span><br><span
                                                            class="line">20</span><br><span
                                                            class="line">21</span><br><span
                                                            class="line">22</span><br></pre>
                                                </td>
                                                <td class="code">
                                                    <pre><span class="line"><span class="comment">//SpringApplicationRunListeners</span></span><br><span
                                                            class="line"><span class="function"><span class="keyword">public</span> <span
                                                            class="keyword">void</span> <span class="title">contextLoaded</span><span
                                                            class="params">(ConfigurableApplicationContext context)</span> </span>&#123;</span><br><span
                                                            class="line">    Iterator var2 = <span
                                                            class="keyword">this</span>.listeners.iterator();</span><br><span
                                                            class="line"></span><br><span class="line">    <span
                                                            class="keyword">while</span>(var2.hasNext()) &#123;</span><br><span
                                                            class="line">        SpringApplicationRunListener listener = (SpringApplicationRunListener)var2.next();</span><br><span
                                                            class="line">        listener.contextLoaded(context);</span><br><span
                                                            class="line">    &#125;</span><br><span
                                                            class="line">&#125;</span><br><span class="line"></span><br><span
                                                            class="line"><span class="comment">//EventPublishingRunListener</span></span><br><span
                                                            class="line"><span class="function"><span class="keyword">public</span> <span
                                                            class="keyword">void</span> <span class="title">contextLoaded</span><span
                                                            class="params">(ConfigurableApplicationContext context)</span> </span>&#123;</span><br><span
                                                            class="line">    ApplicationListener listener;</span><br><span
                                                            class="line">    <span class="keyword">for</span>(Iterator var2 = <span
                                                            class="keyword">this</span>.application.getListeners().iterator(); var2.hasNext(); context.addApplicationListener(listener)) &#123;</span><br><span
                                                            class="line">        listener = (ApplicationListener)var2.next();</span><br><span
                                                            class="line">        <span class="keyword">if</span> (listener <span
                                                            class="keyword">instanceof</span> ApplicationContextAware) &#123;</span><br><span
                                                            class="line">            ((ApplicationContextAware)listener).setApplicationContext(context);</span><br><span
                                                            class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span
                                                            class="line"></span><br><span class="line">    <span
                                                            class="keyword">this</span>.initialMulticaster.multicastEvent(<span
                                                            class="keyword">new</span> ApplicationPreparedEvent(<span
                                                            class="keyword">this</span>.application, <span
                                                            class="keyword">this</span>.args, context));</span><br><span
                                                            class="line">&#125;</span><br></pre>
                                                </td>
                                            </tr>
                                        </table>
                                    </figure>


                                </div>


                                <footer class="post-footer">

                                    <div class="post-tags">

                                        <a href="/tags/Spring/" rel="tag"><i class="fa fa-tag"></i> Spring</a>

                                        <a href="/tags/SpringBoot/" rel="tag"><i class="fa fa-tag"></i> SpringBoot</a>

                                    </div>


                                    <div class="post-nav">
                                        <div class="post-nav-next post-nav-item">

                                            <a href="/2018/03/26/Spring事物传播/" rel="next" title="Spring事物传播">
                                                <i class="fa fa-chevron-left"></i> Spring事物传播
                                            </a>

                                        </div>

                                        <span class="post-nav-divider"></span>

                                        <div class="post-nav-prev post-nav-item">

                                            <a href="/2018/04/09/SpringMVC 添加Swagger-ui/" rel="prev"
                                               title="SpringMVC配置Swagger构建Api文档">
                                                SpringMVC配置Swagger构建Api文档 <i class="fa fa-chevron-right"></i>
                                            </a>

                                        </div>
                                    </div>


                                </footer>
                            </div>


                        </article>


                        <div class="post-spread">

                        </div>
                    </div>


                </div>


                <div onclick="showGitment()" id="gitment_title" class="gitment_title">显示 Gitment 评论</div>
                <div id="container" style="display:none"></div>
                <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
                <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
                <script>
                    const myTheme = {
                        render(state, instance) {
                            const container = document.createElement('div');
                            container.lang = "en-US";
                            container.className = 'gitment-container gitment-root-container';
                            container.appendChild(instance.renderHeader(state, instance));
                            container.appendChild(instance.renderEditor(state, instance));
                            container.appendChild(instance.renderComments(state, instance));
                            container.appendChild(instance.renderFooter(state, instance));
                            return container;
                        }
                    }

                    function showGitment() {
                        $("#gitment_title").attr("style", "display:none");
                        $("#container").attr("style", "").addClass("gitment_container");
                        var gitment = new Gitment({
                            id: 'SpringApplication源码解析',
                            theme: myTheme,
                            owner: "yuanwenjian",
                            repo: "gitment-comments",
                            oauth: {
                                client_id: '21bb0ade50d6f2c9707b',
                                client_secret: '903e69fae75a4c67e11677d996fbf77c4a6f0639'
                            }
                        });
                        gitment.render('container');
                    }
                </script>


            </div>


            <div class="sidebar-toggle">
                <div class="sidebar-toggle-line-wrap">
                    <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
                    <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
                    <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
                </div>
            </div>

            <aside id="sidebar" class="sidebar">

                <div class="sidebar-inner">


                    <ul class="sidebar-nav motion-element">
                        <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
                            文章目录
                        </li>
                        <li class="sidebar-nav-overview" data-target="site-overview-wrap">
                            站点概览
                        </li>
                    </ul>


                    <section class="site-overview-wrap sidebar-panel">
                        <div class="site-overview">
                            <div class="site-author motion-element" itemprop="author" itemscope
                                 itemtype="http://schema.org/Person">

                                <img class="site-author-image" itemprop="image"
                                     src="/images/sanguosha.jpg"
                                     alt="问问苑大宝"/>

                                <p class="site-author-name" itemprop="name">问问苑大宝</p>
                                <p class="site-description motion-element" itemprop="description">策谋本天成，妙手偶得之</p>
                            </div>

                            <nav class="site-state motion-element">


                                <div class="site-state-item site-state-posts">

                                    <a href="/archives/">

                                        <span class="site-state-item-count">64</span>
                                        <span class="site-state-item-name">日志</span>
                                    </a>
                                </div>


                                <div class="site-state-item site-state-categories">
                                    <a href="/categories/index.html">
                                        <span class="site-state-item-count">31</span>
                                        <span class="site-state-item-name">分类</span>
                                    </a>
                                </div>


                                <div class="site-state-item site-state-tags">
                                    <a href="/tags/index.html">
                                        <span class="site-state-item-count">30</span>
                                        <span class="site-state-item-name">标签</span>
                                    </a>
                                </div>


                            </nav>


                        </div>
                    </section>


                    <!--noindex-->
                    <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
                        <div class="post-toc">


                            <div class="post-toc-content">
                                <ol class="nav">
                                    <li class="nav-item nav-level-1"><a class="nav-link"
                                                                        href="#SpringApplication创建"><span
                                            class="nav-number">1.</span> <span
                                            class="nav-text">SpringApplication创建</span></a>
                                        <ol class="nav-child">
                                            <li class="nav-item nav-level-2"><a class="nav-link" href="#加载Initializers"><span
                                                    class="nav-number">1.1.</span> <span
                                                    class="nav-text">加载Initializers</span></a></li>
                                            <li class="nav-item nav-level-2"><a class="nav-link"
                                                                                href="#创建listeners"><span
                                                    class="nav-number">1.2.</span> <span
                                                    class="nav-text">创建listeners</span></a></li>
                                        </ol>
                                    </li>
                                    <li class="nav-item nav-level-1"><a class="nav-link"
                                                                        href="#SpringApplication-run-方法"><span
                                            class="nav-number">2.</span> <span class="nav-text">SpringApplication run()方法</span></a>
                                        <ol class="nav-child">
                                            <li class="nav-item nav-level-2"><a class="nav-link"
                                                                                href="#加载Listeners"><span
                                                    class="nav-number">2.1.</span> <span
                                                    class="nav-text">加载Listeners</span></a>
                                                <ol class="nav-child">
                                                    <li class="nav-item nav-level-3"><a class="nav-link"
                                                                                        href="#EventPublishingRunListener作用"><span
                                                            class="nav-number">2.1.1.</span> <span class="nav-text">EventPublishingRunListener作用</span></a>
                                                    </li>
                                                    <li class="nav-item nav-level-3"><a class="nav-link"
                                                                                        href="#listener-onApplicationEvent-方法与SpringApplication成员属性对应"><span
                                                            class="nav-number">2.1.2.</span> <span class="nav-text">listener.onApplicationEvent 方法与SpringApplication成员属性对应</span></a>
                                                    </li>
                                                    <li class="nav-item nav-level-3"><a class="nav-link"
                                                                                        href="#自定义ApplicationListener，用于初始化后执行特定方法原理"><span
                                                            class="nav-number">2.1.3.</span> <span class="nav-text">自定义ApplicationListener，用于初始化后执行特定方法原理</span></a>
                                                    </li>
                                                </ol>
                                            </li>
                                            <li class="nav-item nav-level-2"><a class="nav-link"
                                                                                href="#prepareEnvironment方法"><span
                                                    class="nav-number">2.2.</span> <span class="nav-text">prepareEnvironment方法</span></a>
                                            </li>
                                            <li class="nav-item nav-level-2"><a class="nav-link"
                                                                                href="#在Context创建前准备环境"><span
                                                    class="nav-number">2.3.</span> <span class="nav-text">在Context创建前准备环境</span></a>
                                                <ol class="nav-child">
                                                    <li class="nav-item nav-level-3"><a class="nav-link"
                                                                                        href="#listeners-environmentPrepared-ConfigurableEnvironment-environment-方法"><span
                                                            class="nav-number">2.3.1.</span> <span class="nav-text">listeners.environmentPrepared((ConfigurableEnvironment)environment)方法</span></a>
                                                    </li>
                                                </ol>
                                            </li>
                                            <li class="nav-item nav-level-2"><a class="nav-link"
                                                                                href="#createApplicationContext-创建上下文-判断是否为web环境，通常为web项目，只分析web环境及返回AnnotationConfigEmbeddedWebApplicationContext"><span
                                                    class="nav-number">2.4.</span> <span class="nav-text">createApplicationContext() 创建上下文,判断是否为web环境，通常为web项目，只分析web环境及返回AnnotationConfigEmbeddedWebApplicationContext</span></a>
                                            </li>
                                            <li class="nav-item nav-level-2"><a class="nav-link"
                                                                                href="#接着上面prepareContext方法"><span
                                                    class="nav-number">2.5.</span> <span class="nav-text">接着上面prepareContext方法</span></a>
                                                <ol class="nav-child">
                                                    <li class="nav-item nav-level-3"><a class="nav-link"
                                                                                        href="#listeners-contextPrepared-context-方法"><span
                                                            class="nav-number">2.5.1.</span> <span class="nav-text">listeners.contextPrepared(context)方法</span></a>
                                                    </li>
                                                    <li class="nav-item nav-level-3"><a class="nav-link"
                                                                                        href="#isteners-contextLoaded-context"><span
                                                            class="nav-number">2.5.2.</span> <span class="nav-text">isteners.contextLoaded(context);</span></a>
                                                    </li>
                                                </ol>
                                            </li>
                                        </ol>
                                    </li>
                                </ol>
                            </div>


                        </div>
                    </section>
                    <!--/noindex-->


                </div>
            </aside>


        </div>
    </main>

    <footer id="footer" class="footer">
        <div class="footer-inner">
            <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
            </script>
            <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
                <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
                <span class="author" itemprop="copyrightHolder">问问苑大宝</span>


            </div>
            <!--

              <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



              <span class="post-meta-divider">|</span>

            <span id="busuanzi_container_site_pv">
                本站总访问量<span id="busuanzi_value_site_pv"></span>次
            </span>

              <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>

            -->


        </div>
    </footer>


    <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>

    </div>


</div>


<script type="text/javascript">
    if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
        window.Promise = null;
    }
</script>


<script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>


<script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>


<script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>


<script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>


<script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


<script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


<script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>


<script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

<script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>


<script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>


<script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>


<!-- LOCAL: You can save these files to your site and update links -->


<link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
<script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>

<!-- END LOCAL -->


<style>
    a.gitment-editor-footer-tip {
        display: none;
    }

    .gitment-container.gitment-footer-container {
        display: none;
    }
</style>


<script type="text/javascript">
    function renderGitment() {
        var gitment = new Gitmint({
            id: 'SpringApplication源码解析',
            owner: 'yuanwenjian',
            repo: 'gitment-comments',

            lang: "" || navigator.language || navigator.systemLanguage || navigator.userLanguage,

            oauth: {


                client_secret: '903e69fae75a4c67e11677d996fbf77c4a6f0639',

                client_id: '21bb0ade50d6f2c9707b'
            }
        });
        gitment.render('gitment-container');
    }


    renderGitment();

</script>


<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>


</body>
</html>
