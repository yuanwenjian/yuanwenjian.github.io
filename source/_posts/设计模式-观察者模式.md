---
title: 设计模式之一 观察者模式
description:  观察者模式
date: 2019-01-01 20:40:00
comments: true
tags: 
    - 设计模式
categories:
    - 设计模式
---

# 观察者模式

观察者模式，主要有两个类Subject,Observer,Subject表示被观察对象，Observer表示观察者，当subject发生变化时，通知所有观察者做出对应方法，比如，气象台更新气温，pc,app更新气温

代码示例
主题Subject 代码
```java
//主题
public interface Subject {
    void addObserver(Observer observer);//添加观察者

    void removeObserver(Observer observer);//删除

    void notifyObserver();//通知
}

// 具体主题，天气
public class WeatherSubject implements Subject {

    private float temperature;//温度

    private float humidity;//湿度

    private float pressure;//气压

    private List<Observer> observers; // 所有观察者

    public WeatherSubject() {
        observers = new ArrayList<>();
    }

    @Override
    public void addObserver(Observer observer) {
        observers.add(observer);
    }

    @Override
    public void removeObserver(Observer observer) {
        if (observers.contains(observer)) {
            observers.remove(observer);
        }
    }

    @Override
    public void notifyObserver() {
        observers.stream().forEach(observer -> observer.update(this));
    }

    // 测量天气
    public void messurements(float temperature, float humidity, float pressure) {
        this.temperature = temperature;
        this.humidity = humidity;
        this.pressure = pressure;
        notifyObserver();//每次测量后通知给观察者
    }
}    

```

观察者代码示例
```java
//观察者
public interface Observer {

    void update(Subject subject);
}

// PC天气
public class PCWeahtherObserve implements Observer {
    @Override
    public void update(Subject subject) {
        WeatherSubject weatherSubject = (WeatherSubject) subject;
        System.out.println("PC更新温度为:"+weatherSubject.getTemperature()+
                "湿度为："+weatherSubject.getHumidity()+
                "大气为："+weatherSubject.getPressure());
    }
}
//APP天气
public class AppWeatherObserver implements Observer{

    @Override
    public void update(Subject subject) {
        WeatherSubject weatherSubject = (WeatherSubject) subject;
        System.out.println("app更新温度为:"+weatherSubject.getTemperature()+
                "湿度为："+weatherSubject.getHumidity()+
                "大气为："+weatherSubject.getPressure());
    }
}
```

测试
```java
    public static void main(String[] args) {
        WeatherSubject weatherSubject = new WeatherSubject();
        PCWeahtherObserve pcWeahtherObserve = new PCWeahtherObserve();
        AppWeatherObserver appWeatherObserver = new AppWeatherObserver();
        weatherSubject.addObserver(pcWeahtherObserve);
        weatherSubject.addObserver(appWeatherObserver);
        weatherSubject.messurements(23f, 4.5f, 6.7f);
    }

    结果
    PC更新温度为:23.0湿度为：4.5大气为：6.7
    app更新温度为:23.0湿度为：4.5大气为：6.7

```
当以后再增加天气显示类型时，不用动之前代码，新添加Observer,并将添加到主题观察列表即可
# 事件模式

事件为也为观察者模式，事件通常有三个类，事件，事件源，事件监听器，事件流程通常为【事件源注册监听器】--> 【事件发生,事件源向监听器发送事件】 --> 【事件监听器响应事件】

需求：订单出库后，订单生成报表，并统计员工绩效

代码示例
```java
//事件
public interface Event {
}


/*事件监听器*/
public interface EventListener {
    void listener(Event event);
}

//以下为具体实现
//具体事件
public class OrderEvent implements Event {

    private String orderCode;

    /*....setter,getter*/
}

/*事件源*/
public class OrderEventSource {

    private List<EventListener> listeners;

    public void addListener(EventListener eventListener) {//注册监听器
        if (listeners == null) {
            listeners = new ArrayList<>();
        }
        listeners.add(eventListener);
    }

    @Override
    public void onEvent(Event event) {//发布事件
        listeners.forEach(listeners->listeners.listener(event));
    }
}

// 事件监听器，插入报表
public class OrderReportListener implements EventListener {
    @Override
    public void listener(Event event) {
        if (event instanceof OrderEvent) {
            OrderEvent orderEvent = (OrderEvent) event;
            System.out.println("订单"+orderEvent.getOrderCode()+"已经发货,插入报表");
        }
    }
}


// 事件监听器，插入绩效
public class OrderListener implements EventListener {
    @Override
    public void listener(Event event) {
        if (event instanceof OrderEvent) {
            OrderEvent orderEvent = (OrderEvent) event;
            System.out.println("订单编码" + orderEvent.getOrderCode() + "已发货,插入绩效表中");
        }
    }
}

//测试
 public static void main(String[] args) {
        OrderEvent orderEvent = new OrderEvent();
        orderEvent.setOrderCode("yuanwj");

        OrderEventSource orderEventSource = new OrderEventSource();
        OrderListener orderListener = new OrderListener();
        OrderReportListener orderReportListener = new OrderReportListener();
        orderEventSource.addListener(orderListener);
        orderEventSource.addListener(orderReportListener);


        orderEventSource.onEvent(orderEvent);
    }

//订单编码yuanwj已发货,插入绩效表中
//订单yuanwj已经发货,插入报表
```